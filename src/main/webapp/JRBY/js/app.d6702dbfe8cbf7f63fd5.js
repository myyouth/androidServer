webpackJsonp([1],{"4ml/":function(a,e){},Gnxq:function(a,e){},NHnr:function(a,e,t){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var s=t("7+uW"),i={render:function(){var a=this.$createElement,e=this._self._c||a;return e("div",{staticStyle:{height:"100%"},attrs:{id:"app"}},[e("router-view")],1)},staticRenderFns:[]};var n=t("VU/8")({name:"App"},i,!1,function(a){t("ZsvG")},null,null).exports,l=t("/ocq"),o=t("Fd2+");s.default.use(o.d),s.default.use(o.c);var r={name:"JobBooking",data:function(){return{number:"",scannerNumber:"",transferCardNumber:"",materialNumber:"",flag:!0,processNumber:"",processID:"",orderNumber:"",inputNumber:"",outputNumber:"",badID:"",badProject:"",showProcessPicker:!1,showBadPicker:!1,unitTime:1,hourlyWage:1,processes:[{processID:"12",text:"工序1"},{processID:"13",text:"工序2"},{processID:"14",text:"工序3"},{processID:"15",text:"工序4"},{processID:"16",text:"工序5"}],bads:[{BadID:"12",text:"工序1"},{BadID:"13",text:"工序2"},{BadID:"14",text:"工序3"},{BadID:"15",text:"工序4"},{BadID:"16",text:"工序5"}]}},components:{},created:function(){this.getAllBadDes()},mounted:function(){window.scannerSearch=this.scannerSearch},computed:{badNumber:function(){return(this.inputNumber-this.outputNumber).toFixed(0)<=0&&(this.badProject="",this.badID=""),(this.inputNumber-this.outputNumber).toFixed(0)},taskTime:function(){return(this.outputNumber/this.unitTime).toFixed(2)},badProjectshow:function(){return this.badNumber>0},charges:function(){return(this.taskTime*this.hourlyWage).toFixed(2)}},watch:{scannerNumber:{deep:!0,handler:function(a,e){this.number=a,this.onSearch()}}},methods:{onSearch:function(){var a=this;android.showLodingDialog("正在获取工序流转卡数据..."),this.$api.get("/selectProcessBooking",{Number:this.number},function(e){android.closeLodingDialog(),a.clear(),e.status>=200&&e.status<300?0==e.data.msg.transferCardNumber.length?o.e.fail("工序流转单不存在,请确认工序流转卡编码"):0==e.data.msg.processes.length?o.e.fail("当前工单已报工完毕"):(o.e.success("获取工序流转单成功"),a.transferCardNumber=e.data.msg.transferCardNumber,a.orderNumber=e.data.msg.orderNumber,a.materialNumber=e.data.msg.materialNumber,a.onProcessConfirm(e.data.msg.processes),a.hourlyWage=e.data.msg.hourlyWage,a.bads=e.data.msg.badDec,a.flag=!1):o.e.fail("获取工序流转单时出现异常，请重新操作")})},onProcessConfirm:function(a){this.processNumber=a.text,this.processID=a.processID,this.unitTime=a.unitTime},onBadConfirm:function(a){this.badID=a.badID,this.badProject=a.text,this.showBadPicker=!1},clear:function(){this.transferCardNumber="",this.processNumber="",this.processID="",this.inputNumber="",this.outputNumber="",this.badProject="",this.badID="",this.materialNumber=""},submit:function(){var a=this;this.badNumber<0?o.e.fail("产出数量不得大于投入数量"):this.badNumber>0&&""==this.badID?o.e.fail("存在不良，请填写不良项目"):this.processID.length>0&&this.inputNumber.length>0&&this.outputNumber.length>0&&this.taskTime.length>0?o.a.confirm({title:"确认",message:"请确认当前数据已填写正确"}).then(function(){android.showLodingDialog("正在提交工序流转卡数据...");var e={transferCardNumber:a.transferCardNumber,processID:a.processID,processNumber:a.processNumber,inputNumber:a.inputNumber,outputNumber:a.outputNumber,taskTime:a.taskTime,badID:a.badID,badNumber:a.badNumber,badProject:a.badProject,userID:android.getUserID(),orderNumber:a.orderNumber};a.$api.get("/submitProcessBooking",{submitData:e},function(a){android.closeLodingDialog(),a.status>=200&&a.status<300?"true"==a.data.success?o.a.alert({message:a.data.msg}).then(function(){android.back()}):o.e.fail(a.data.msg):o.e.fail("数据提交出现异常,请重新提交")})}).catch(function(){}):o.e.fail("请填写必填项")},getAllBadDes:function(){var a=this;android.showLodingDialog("正在加载基础数据..."),this.$api.get("/selectAllBadDes",{},function(e){android.closeLodingDialog(),e.status>=200&&e.status<300&&"true"==e.data.success?a.bads=e.data.msg:android.alertDialog("警告","获取不良项目出现异常，请重新打开")})},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.scannerNumber=a}}},c={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("Div",{staticStyle:{padding:"0.2rem"}},[t("van-search",{staticStyle:{"margin-right":"1rem"},attrs:{placeholder:"请输入工序流转卡批号","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch},model:{value:a.number,callback:function(e){a.number=e},expression:"number"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)]),a._v(" "),t("van-cell-group",[a._e(),a._v(" "),t("van-field",{attrs:{label:"型号：",disabled:"","label-align":"left"},model:{value:a.materialNumber,callback:function(e){a.materialNumber=e},expression:"materialNumber"}}),a._v(" "),a._e(),a._v(" "),t("van-field",{attrs:{readonly:"",disabled:"",label:"工序号：","label-align":"left",value:a.processNumber}}),a._v(" "),t("van-field",{attrs:{required:"",disabled:a.flag,label:"投入数：","label-align":"left",type:"number"},model:{value:a.inputNumber,callback:function(e){a.inputNumber=e},expression:"inputNumber"}}),a._v(" "),t("van-field",{attrs:{required:"",disabled:a.flag,label:"产出数：","label-align":"left",type:"number"},model:{value:a.outputNumber,callback:function(e){a.outputNumber=e},expression:"outputNumber"}}),a._v(" "),t("van-field",{attrs:{label:"不良数：","label-align":"left",disabled:"",type:"number"},model:{value:a.badNumber,callback:function(e){a.badNumber=e},expression:"badNumber"}}),a._v(" "),a._e(),a._v(" "),t("van-field",{attrs:{disabled:"",label:"加工费：","label-align":"left",type:"number"},model:{value:a.charges,callback:function(e){a.charges=e},expression:"charges"}}),a._v(" "),0==a.flag&&1==a.badProjectshow?t("van-field",{attrs:{readonly:"",clickable:"",label:"不良项目：","label-align":"left",value:a.badProject,placeholder:"选择不良项目"},on:{click:function(e){a.showBadPicker=!0}}}):t("van-field",{attrs:{readonly:"",clickable:"",label:"不良项目：","label-align":"left",value:a.badProject,placeholder:"选择不良项目"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showBadPicker,callback:function(e){a.showBadPicker=e},expression:"showBadPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.bads},on:{cancel:function(e){a.showBadPicker=!1},confirm:a.onBadConfirm}})],1)],1),a._v(" "),t("div",{staticStyle:{"margin-top":"1rem"}},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.clear}},[a._v("清空")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger",disabled:a.flag},on:{click:a.submit}},[a._v("提交")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)],1)},staticRenderFns:[]};var u=t("VU/8")(r,c,!1,function(a){t("Gnxq")},"data-v-47e309f2",null).exports,d={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"hello"},[t("h1",[a._v(a._s(a.msg))]),a._v(" "),t("h2",[a._v("Essential Links")]),a._v(" "),a._m(0),a._v(" "),t("h2",[a._v("Ecosystem")]),a._v(" "),a._m(1)])},staticRenderFns:[function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("ul",[t("li",[t("a",{attrs:{href:"https://vuejs.org",target:"_blank"}},[a._v("\n        Core Docs\n      ")])]),a._v(" "),t("li",[t("a",{attrs:{href:"https://forum.vuejs.org",target:"_blank"}},[a._v("\n        Forum\n      ")])]),a._v(" "),t("li",[t("a",{attrs:{href:"https://chat.vuejs.org",target:"_blank"}},[a._v("\n        Community Chat\n      ")])]),a._v(" "),t("li",[t("a",{attrs:{href:"https://twitter.com/vuejs",target:"_blank"}},[a._v("\n        Twitter\n      ")])]),a._v(" "),t("br"),a._v(" "),t("li",[t("a",{attrs:{href:"http://vuejs-templates.github.io/webpack/",target:"_blank"}},[a._v("\n        Docs for This Template\n      ")])])])},function(){var a=this.$createElement,e=this._self._c||a;return e("ul",[e("li",[e("a",{attrs:{href:"http://router.vuejs.org/",target:"_blank"}},[this._v("\n        vue-router\n      ")])]),this._v(" "),e("li",[e("a",{attrs:{href:"http://vuex.vuejs.org/",target:"_blank"}},[this._v("\n        vuex\n      ")])]),this._v(" "),e("li",[e("a",{attrs:{href:"http://vue-loader.vuejs.org/",target:"_blank"}},[this._v("\n        vue-loader\n      ")])]),this._v(" "),e("li",[e("a",{attrs:{href:"https://github.com/vuejs/awesome-vue",target:"_blank"}},[this._v("\n        awesome-vue\n      ")])])])}]};var m=t("VU/8")({name:"HelloWorld",data:function(){return{msg:"Welcome to Your Vue.js App"}}},d,!1,function(a){t("UEbX")},"data-v-d8ec41bc",null).exports,b={name:"RevisePassword",data:function(){return{password:"",password_comfirm:""}},methods:{clear:function(){this.password="",this.password_comfirm=""},submit:function(){0==this.password_comfirm.length||0==this.password.length?o.e.fail("填写密码不得为空"):this.password!=this.password_comfirm?o.e.fail("填写密码不一致"):(android.showLodingDialog("正在修改账号密码..."),this.$api.get("/revisePassword",{staffID:android.getUserID(),staffPassword:this.password},function(a){android.closeLodingDialog(),a.status>=200&&a.status<300?(android.toastLog(a.data.msg),android.back()):o.e.fail("重置密码出现异常")}))}},computed:{}},v={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticStyle:{padding:"0.2rem"}},[t("van-field",{attrs:{type:"password",placeholder:"请输入登录密码",clearable:"","label-width":"3.5rem"},model:{value:a.password,callback:function(e){a.password=e},expression:"password"}}),a._v(" "),t("van-field",{attrs:{type:"password",placeholder:"请再次输入登录密码",clearable:"","label-width":"3.5rem"},model:{value:a.password_comfirm,callback:function(e){a.password_comfirm=e},expression:"password_comfirm"}}),a._v(" "),t("van-row",{staticStyle:{"margin-top":"1rem"}},[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.clear}},[a._v("清空")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.submit}},[a._v("提交")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)},staticRenderFns:[]},f=t("VU/8")(b,v,!1,null,null,null).exports,p={data:function(){return{barcodeNumber:"",loading:!1,activeMateName:"",activeDocName:"",docList:[],materialInfo:[]}},methods:{toastLog:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},dealBarcodeNumber:function(){var a=this;0!=this.barcodeNumber.length?(this.toastLog("正在获取数据..."),this.$api.get("/searchBarcodeNumber",{BarcodeNumber:this.barcodeNumber,id:1},function(e){return e.status>=200&&e.status<300?(o.e.clear(),"true"!=e.data.success?(o.e.clear(),void o.e.fail(e.data.msg)):(a.activeDocName=1,o.e.success("条码查询成功"),a.materialInfo=JSON.parse(e.data.msg),void a.$api.get("/selectInventory",{materialNumber:a.materialInfo[0].mNumber},function(e){if(e.status>=200&&e.status<300){if(o.e.clear(),"true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);var t=JSON.parse(e.data.msg);a.$set(t,"id",a.docList.length+1);var s=0;a.docList.some(function(a,e){s=a.materialList.length+e}),t.materialList.some(function(e,t){s+=1,a.$set(e,"id",s)}),a.docList.push(t),o.e.success("成功"),console.log(a.docList)}}))):(o.e.clear(),void o.e.fail("数据获取异常！"))})):o.e.fail("条码不得为空！")},onBack:function(){android.back()},deleteMaterial:function(){var a=this;this.docList.some(function(e,t){e.id==a.activeDocName&&e.materialList.some(function(t,s){if(t.id==a.activeMateName)return 1==e.materialList.length?a.deleteConsignment():e.materialList.splice(s,1),!0})})},deleteConsignment:function(){var a=this;this.docList.some(function(e,t){if(e.id==a.activeDocName)return a.docList.splice(t,1),!0})},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.dealBarcodeNumber()}}},h={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{placeholder:"请输入条码编号","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.dealBarcodeNumber,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.dealBarcodeNumber(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.dealBarcodeNumber},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("即时库存")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeDocName,callback:function(e){a.activeDocName=e},expression:"activeDocName"}},a._l(a.docList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-collapse",{attrs:{accordion:""},model:{value:a.activeMateName,callback:function(e){a.activeMateName=e},expression:"activeMateName"}},a._l(e.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.stockPlace,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料名称：",disabled:"","label-align":"left"},model:{value:e.materialName,callback:function(t){a.$set(e,"materialName",t)},expression:"item.materialName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"数量：",disabled:"","label-align":"left"},model:{value:e.fQty,callback:function(t){a.$set(e,"fQty",t)},expression:"item.fQty"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.fBatchNo,callback:function(t){a.$set(e,"fBatchNo",t)},expression:"item.fBatchNo"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.fstockName,callback:function(t){a.$set(e,"fstockName",t)},expression:"item.fstockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.stockPlace,callback:function(t){a.$set(e,"stockPlace",t)},expression:"item.stockPlace"}})],1)],1)],1)}),1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},k=t("VU/8")(p,h,!1,null,null,null).exports,g={data:function(){return{feedNumber:"",list:[],loading:!1,finished:!1}},methods:{onLoad:function(){this.finished=!0},onSearch:function(){var a=this;o.e.loading({duration:0,message:"加载中...",forbidClick:!0}),-1!=this.feedNumber.indexOf("FBillNo")&&(this.feedNumber=this.feedNumber.substring(8,this.feedNumber.indexOf(","))),this.$api.get("/searchAllProFeed",{feedNumber:this.feedNumber},function(e){o.e.clear(),e.status>=200&&e.status<300?"true"==e.data.success?a.list=e.data.msg:o.e.fail(e.data.msg):o.e.fail("获取数据时出现异常，请重新操作")}),this.finished=!0},createProRequisit:function(a){this.$router.push({path:"/producionFeedingForProductRequisit",query:{number:a}})},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.feedNumber=a,this.onSearch()}}},N={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",[t("van-search",{staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{placeholder:"请输入生产投料单编码","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch},model:{value:a.feedNumber,callback:function(e){a.feedNumber=e},expression:"feedNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)]),a._v(" "),t("van-list",{staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{finished:a.finished,"finished-text":"没有更多了"},on:{load:a.onLoad},model:{value:a.loading,callback:function(e){a.loading=e},expression:"loading"}},a._l(a.list,function(e){return t("van-cell",{key:e,attrs:{title:e},on:{click:function(t){return a.createProRequisit(e)}}})}),1)],1)},staticRenderFns:[]},_=t("VU/8")(g,N,!1,null,null,null).exports,w=t("mvHQ"),S=t.n(w),D={data:function(){return{barcodeNumber:"",baseData:{type:"",typeId:"",subject:"",subjectId:"",purpose:"",dept:"",deptId:"",shipper:"",shipperId:"",safeKeeping:"",safeKeepingId:"",creatorId:android.getUserID()},activeName:"",ReqActiveName:"",showSubjectPicker:!1,materialList:[],ReqMaterialList:[],subjects:[{id:1,text:133},{id:2,text:13}],showShipperPicker:!1,shippers:[{id:1,text:"张三"},{id:2,text:"李四"}],showSafekeepingPicker:!1,safekeepings:[],barcodeList:[]}},created:function(){this.searchProFeedInfo(),this.searchAllAccount(),this.searchAllEmp()},mounted:function(){window.scannerSearch=this.scannerSearch},methods:{showLoading:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},searchProFeedInfo:function(){var a=this;this.showLoading("正在获取数据..."),this.$api.get("/searchProFeedInfo",{feedNumber:this.$route.query.number},function(e){return e.status>=200&&e.status<300?"true"!=e.data.success?(o.e.fail(e.data.msg),void o.e.clear()):(a.materialList=e.data.data,a.baseData.type=e.data.typeName,a.baseData.typeId=e.data.type,a.baseData.dept=e.data.dept,a.baseData.deptId=e.data.deptId,void o.e.clear()):(o.e.fail("数据获取异常！"),void o.e.clear())})},searchAllAccount:function(){var a=this;this.showLoading("正在获取数据..."),this.$api.get("/searchAllAccount",{},function(e){return e.status>=200&&e.status<300?"true"!=e.data.success?(o.e.fail(e.data.msg),void o.e.clear()):(a.subjects=e.data.subjects,void o.e.clear()):(o.e.fail("数据获取异常！"),void o.e.clear())})},searchAllEmp:function(){var a=this;this.$api.get("/selectAllEmpInfo",{},function(e){o.e.clear(),e.status>=200&&e.status<300?"true"==e.data.success?(a.shippers=e.data.data,a.safekeepings=e.data.data,o.e.success("数据获取成功")):o.e.fail(e.data.msg):o.e.fail("数据获取异常！")})},onSubmit:function(){o.e.loading({duration:0,message:"正在提交数据...",forbidClick:!0}),this.$api.post("/submitProductRequisit",{baseData:S()(this.baseData),materialList:S()(this.ReqMaterialList),barcodeList:S()(this.barcodeList)},function(a){return a.status>=200&&a.status<300?"true"!=a.data.success?(o.e.clear(),void o.e.fail(a.data.msg)):(o.e.success("数据提交成功"),void android.back()):(o.e.clear(),void o.e.fail("数据提交异常！"))})},onBack:function(){this.$router.go(-1)},onBSubjectConfirm:function(a){this.baseData.subject=a.text,this.baseData.subjectId=a.id,this.showSubjectPicker=!1},deleteMaterial:function(){var a=this;this.ReqMaterialList.some(function(e,t){if(e.id==a.ReqActiveName)return a.ReqMaterialList.splice(t,1),a.barcodeList.some(function(s,i){e.barcodeNumber==s.barcodeNumber&&a.barcodeList.splice(t,1)}),!0})},onSearch:function(){var a=this;if(0!=this.barcodeNumber.length){var e=!1;this.barcodeList.some(function(t,s){t.barcodeNumber==a.barcodeNumber&&(o.e.fail("条码已扫描"),e=!0)}),e?this.barcodeNumber="":(this.showLoading("正在获取数据..."),this.$api.get("/searchBarcodeNumber",{BarcodeNumber:this.barcodeNumber,id:"1"},function(e){if(o.e.clear(),a.barcodeNumber="",a.focusNextInput(),!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("条码查询异常！");if("true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);o.e.success("条码查询成功");var t=JSON.parse(e.data.msg);a.materialList.some(function(e,s){"*"==e.stockPlace&&(e.stockPlace=""),t.some(function(t,s){var i=!1,n=e.icmoNum.split("-"),l=Number(n[0]),o=Number(n[0])+Number(e.materialSum)-1,r=Number(t.zBM);if(Number(e.materialSum)>0&&r>=l&&r<=o&&(i=!0),e.materialNumber==t.mNumber&&e.stockName==t.warehouse&&i){var c=JSON.parse(S()(e));c.id=a.ReqMaterialList.length+1,c.materialActualSum=Number(t.mSum),c.stockPlace=t.position,c.stockPlaceID=t.positionId,c.barcodeNumber=t.barcodeNumber,c.zbm=t.zBM,a.ReqMaterialList.push(c),a.ReqActiveName=c.id,a.barcodeList.push(t)}})})}))}},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.onSearch()},onShipperConfirm:function(a){this.baseData.shipper=a.text,this.baseData.shipperId=a.id,this.showShipperPicker=!1},onSafekeepingConfirm:function(a){this.baseData.safeKeeping=a.text,this.baseData.safeKeepingId=a.id,this.showSafekeepingPicker=!1},focusNextInput:function(){document.getElementsByTagName("input")[0].focus()}}},x={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{attrs:{placeholder:"","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearch(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("基本信息")]),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"领料类型：",disabled:"","label-align":"left"},model:{value:a.baseData.type,callback:function(e){a.$set(a.baseData,"type",e)},expression:"baseData.type"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"对方科目：",disabled:"","label-align":"left",readonly:"",clickable:""},on:{click:function(e){a.showSubjectPicker=!0}},model:{value:a.baseData.subject,callback:function(e){a.$set(a.baseData,"subject",e)},expression:"baseData.subject"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showSubjectPicker,callback:function(e){a.showSubjectPicker=e},expression:"showSubjectPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.subjects},on:{cancel:function(e){a.showSubjectPicker=!1},confirm:a.onBSubjectConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"领料部门：",disabled:"","label-align":"left"},model:{value:a.baseData.dept,callback:function(e){a.$set(a.baseData,"dept",e)},expression:"baseData.dept"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"领料用途：","label-align":"left",autosize:"",rows:"1",type:"textarea"},model:{value:a.baseData.purpose,callback:function(e){a.$set(a.baseData,"purpose",e)},expression:"baseData.purpose"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"领料：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showSafekeepingPicker=!0}},model:{value:a.baseData.safeKeeping,callback:function(e){a.$set(a.baseData,"safeKeeping",e)},expression:"baseData.safeKeeping"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showSafekeepingPicker,callback:function(e){a.showSafekeepingPicker=e},expression:"showSafekeepingPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.safekeepings},on:{cancel:function(e){a.showSafekeepingPicker=!1},confirm:a.onSafekeepingConfirm}})],1)],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"发料：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showShipperPicker=!0}},model:{value:a.baseData.shipper,callback:function(e){a.$set(a.baseData,"shipper",e)},expression:"baseData.shipper"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showShipperPicker,callback:function(e){a.showShipperPicker=e},expression:"showShipperPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.shippers},on:{cancel:function(e){a.showShipperPicker=!1},confirm:a.onShipperConfirm}})],1)],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("生产投料单物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.materialBatch,callback:function(t){a.$set(e,"materialBatch",t)},expression:"item.materialBatch"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.stockName,callback:function(t){a.$set(e,"stockName",t)},expression:"item.stockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.stockPlace,callback:function(t){a.$set(e,"stockPlace",t)},expression:"item.stockPlace"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"申请数量：","label-align":"left",type:"number"},model:{value:e.materialSum,callback:function(t){a.$set(e,"materialSum",t)},expression:"item.materialSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"单位：","label-align":"left"},model:{value:e.unitName,callback:function(t){a.$set(e,"unitName",t)},expression:"item.unitName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"自编码：",disabled:"","label-align":"left"},model:{value:e.icmoNum,callback:function(t){a.$set(e,"icmoNum",t)},expression:"item.icmoNum"}})],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("生产领料单物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.ReqActiveName,callback:function(e){a.ReqActiveName=e},expression:"ReqActiveName"}},a._l(a.ReqMaterialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.materialBatch,callback:function(t){a.$set(e,"materialBatch",t)},expression:"item.materialBatch"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.stockName,callback:function(t){a.$set(e,"stockName",t)},expression:"item.stockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.stockPlace,callback:function(t){a.$set(e,"stockPlace",t)},expression:"item.stockPlace"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"申请数量：","label-align":"left",type:"number"},model:{value:e.materialSum,callback:function(t){a.$set(e,"materialSum",t)},expression:"item.materialSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"单位：","label-align":"left"},model:{value:e.unitName,callback:function(t){a.$set(e,"unitName",t)},expression:"item.unitName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"实发数量：","label-align":"left",type:"number",disabled:""},model:{value:e.materialActualSum,callback:function(t){a.$set(e,"materialActualSum",t)},expression:"item.materialActualSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"单位：","label-align":"left"},model:{value:e.unitName,callback:function(t){a.$set(e,"unitName",t)},expression:"item.unitName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"自编码：","label-align":"left",disabled:""},model:{value:e.zbm,callback:function(t){a.$set(e,"zbm",t)},expression:"item.zbm"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"条码编号：","label-align":"left",disabled:""},model:{value:e.barcodeNumber,callback:function(t){a.$set(e,"barcodeNumber",t)},expression:"item.barcodeNumber"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("提交")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},P=t("VU/8")(D,x,!1,null,null,null).exports,y={data:function(){return{barcodeNumber:"",loading:!1,activeDocName:"",activeMateName:"",docList:[]}},methods:{toastLog:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},dealBarcodeNumber:function(){var a=this;0!=this.barcodeNumber.length?(-1!=this.barcodeNumber.indexOf("FBillNo")&&(this.barcodeNumber=this.barcodeNumber.substring(8,this.barcodeNumber.indexOf(","))),this.toastLog("正在获取数据..."),this.$api.get("/selectNoteInfo",{billNo:this.barcodeNumber},function(e){if(!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("数据获取异常！");if(o.e.clear(),"true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);var t=JSON.parse(e.data.msg),s=!0;if(a.docList.some(function(a,e){a.purchasingUnit!=t.purchasingUnit&&(o.e.fail("购货单位必须一致！"),s=!1)}),s){a.$set(t,"id",a.docList.length+1);var i=0;a.docList.some(function(a,e){i=a.materialList.length+e}),t.materialList.some(function(e,t){i+=1,a.$set(e,"id",i)}),a.docList.push(t),o.e.success("成功"),console.log(a.docList)}})):o.e.fail("发货单号不得为空！")},onBack:function(){android.back()},onSubmit:function(){0!=this.docList.length?this.$router.push({path:"/consignmentNoteForSaleIssue",query:{data:this.docList}}):o.e.fail("发货通知单数据不得为空！")},deleteMaterial:function(){var a=this;this.docList.some(function(e,t){e.id==a.activeDocName&&e.materialList.some(function(t,s){if(t.id==a.activeMateName)return 1==e.materialList.length?a.deleteConsignment():e.materialList.splice(s,1),!0})})},deleteConsignment:function(){var a=this;this.docList.some(function(e,t){if(e.id==a.activeDocName)return a.docList.splice(t,1),!0})},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.dealBarcodeNumber()}}},C={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{placeholder:"请输入发货通知单","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.dealBarcodeNumber,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.dealBarcodeNumber(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.dealBarcodeNumber},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("发货通知单数据")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeDocName,callback:function(e){a.activeDocName=e},expression:"activeDocName"}},a._l(a.docList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.docNumber,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单据编码：",disabled:"","label-align":"left"},model:{value:e.docNumber,callback:function(t){a.$set(e,"docNumber",t)},expression:"doc.docNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"购货单位：",disabled:"","label-align":"left"},model:{value:e.purchasingUnit,callback:function(t){a.$set(e,"purchasingUnit",t)},expression:"doc.purchasingUnit"}})],1)],1),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeMateName,callback:function(e){a.activeMateName=e},expression:"activeMateName"}},a._l(e.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialNumber,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料名称：",disabled:"","label-align":"left"},model:{value:e.materialName,callback:function(t){a.$set(e,"materialName",t)},expression:"item.materialName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"数量：",disabled:"","label-align":"left"},model:{value:e.materialSum,callback:function(t){a.$set(e,"materialSum",t)},expression:"item.materialSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：",disabled:"","label-align":"left"},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.stockName,callback:function(t){a.$set(e,"stockName",t)},expression:"item.stockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.stockPlace,callback:function(t){a.$set(e,"stockPlace",t)},expression:"item.stockPlace"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.materialBatch,callback:function(t){a.$set(e,"materialBatch",t)},expression:"item.materialBatch"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[""==a.activeMateName||0==e.materialList.length?t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteConsignment}},[a._v("删除")]):a._e()],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("确定")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},$=t("VU/8")(y,C,!1,null,null,null).exports,L={data:function(){return{barcodeNumber:"",baseData:{},activeName:"",saleActiveName:"",showSalesWayPicker:!1,salesWays:[{id:1,text:133},{id:2,text:13}],showShipperPicker:!1,shippers:[{id:1,text:"张三"},{id:2,text:"李四"}],showSafekeepingPicker:!1,Safekeepings:[],materialList:[],saleMaterialList:[],barcodeList:[]}},created:function(){var a=this;this.showLoading("正在加载...");var e=this.$route.query.data;this.baseData.type=e[0].type,this.baseData.typeId=e[0].typeId,this.baseData.salesWay=e[0].salesWay,this.baseData.salesWayId=e[0].salesWayId,this.baseData.purchasingUnit=e[0].purchasingUnit,this.baseData.purchasingUnitId=e[0].purchasingUnitId,this.baseData.dept=e[0].dept,this.baseData.deptId=e[0].deptId,this.baseData.director=e[0].director,this.baseData.directorId=e[0].directorId,this.baseData.salesMan=e[0].salesMan,this.baseData.salesManId=e[0].salesManId,this.baseData.shipper=e[0].shipper,this.baseData.shipperId=e[0].shipperId,this.baseData.creatorId=android.getUserID(),e.some(function(e,t){e.materialList.some(function(e,t){a.materialList.push(e)})}),this.$api.get("/selectAllEmpInfo",{},function(e){o.e.clear(),e.status>=200&&e.status<300?"true"==e.data.success?(a.shippers=e.data.data,a.Safekeepings=e.data.data,o.e.success("数据获取成功")):o.e.fail(e.data.msg):o.e.fail("数据获取异常！")})},mounted:function(){window.scannerSearch=this.scannerSearch},methods:{showLoading:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},onSubmit:function(){this.showLoading("正在提交数据..."),this.$api.post("/submitSaleIssue",{baseData:S()(this.baseData),materialList:S()(this.saleMaterialList),barcodeList:S()(this.barcodeList)},function(a){o.e.clear(),a.status>=200&&a.status<300?"true"==a.data.success?(o.e.success("数据提交成功"),android.back()):o.e.fail(a.data.msg):o.e.fail("数据提交异常！")})},onBack:function(){this.$router.go(-1)},onSalesWayConfirm:function(a){this.baseData.salesWay=a.text,this.baseData.salesWayId=a.id,this.showSalesWayPicker=!1},onShipperConfirm:function(a){this.baseData.shipper=a.text,this.baseData.shipperId=a.id,this.showShipperPicker=!1},onSafekeepingConfirm:function(a){this.baseData.safeKeeping=a.text,this.baseData.safeKeepingId=a.id,this.showSafekeepingPicker=!1},deleteMaterial:function(){var a=this;this.saleMaterialList.some(function(e,t){if(e.id==a.saleActiveName)return a.saleMaterialList.splice(t,1),a.barcodeList.some(function(s,i){e.materialNumber==s.mNumber&&a.barcodeList.splice(t,1)}),!0})},onSearch:function(){var a=this;if(0!=this.barcodeNumber.length){var e=!1;this.barcodeList.some(function(t,s){t.barcodeNumber==a.barcodeNumber&&(o.e.fail("条码已扫描"),e=!0)}),e?this.barcodeNumber="":this.$api.get("/searchBarcodeNumber",{BarcodeNumber:this.barcodeNumber,id:1},function(e){if(a.barcodeNumber="",a.focusNextInput(),!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("条码查询异常！");if("true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);o.e.success("条码查询成功");var t=JSON.parse(e.data.msg);a.materialList.some(function(e,s){"*"==e.stockPlace&&(e.stockPlace=""),t.some(function(t,s){if(e.materialNumber==t.mNumber&&e.materialBatch==t.batch&&e.stockName==t.warehouse){var i=!0;if(a.saleMaterialList.some(function(e,s){e.materialNumber==t.mNumber&&e.materialBatch==t.batch&&e.stockName==t.warehouse&&e.stockPlace==t.position&&(e.materialActualSum=Number(e.materialActualSum)+Number(t.mSum),i=!1,a.saleActiveName=e.id,a.barcodeList.push(t))}),i){var n=JSON.parse(S()(e));n.id=a.saleMaterialList.length+1,n.materialActualSum=Number(t.mSum),n.stockPlace=t.position,n.stockPlaceId=t.positionId,a.saleMaterialList.push(n),a.saleActiveName=n.id,a.barcodeList.push(t)}}})})})}},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.onSearch()},focusNextInput:function(){document.getElementsByTagName("input")[0].focus()}}},I={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{attrs:{placeholder:"","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearch(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("基本信息")]),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"销售业务类型：",disabled:"","label-align":"left"},model:{value:a.baseData.type,callback:function(e){a.$set(a.baseData,"type",e)},expression:"baseData.type"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"销售方式：",disabled:"","label-align":"left",readonly:"",clickable:""},on:{click:function(e){a.showSalesWayPicker=!1}},model:{value:a.baseData.salesWay,callback:function(e){a.$set(a.baseData,"salesWay",e)},expression:"baseData.salesWay"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showSalesWayPicker,callback:function(e){a.showSalesWayPicker=e},expression:"showSalesWayPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.salesWays},on:{cancel:function(e){a.showSalesWayPicker=!1},confirm:a.onSalesWayConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"购货单位：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.purchasingUnit,callback:function(e){a.$set(a.baseData,"purchasingUnit",e)},expression:"baseData.purchasingUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"部门：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.dept,callback:function(e){a.$set(a.baseData,"dept",e)},expression:"baseData.dept"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"主管：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.director,callback:function(e){a.$set(a.baseData,"director",e)},expression:"baseData.director"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"业务员：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.salesMan,callback:function(e){a.$set(a.baseData,"salesMan",e)},expression:"baseData.salesMan"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"发货：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showShipperPicker=!0}},model:{value:a.baseData.shipper,callback:function(e){a.$set(a.baseData,"shipper",e)},expression:"baseData.shipper"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showShipperPicker,callback:function(e){a.showShipperPicker=e},expression:"showShipperPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.shippers},on:{cancel:function(e){a.showShipperPicker=!1},confirm:a.onShipperConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"保管：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showSafekeepingPicker=!0}},model:{value:a.baseData.safeKeeping,callback:function(e){a.$set(a.baseData,"safeKeeping",e)},expression:"baseData.safeKeeping"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showSafekeepingPicker,callback:function(e){a.showSafekeepingPicker=e},expression:"showSafekeepingPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.Safekeepings},on:{cancel:function(e){a.showSafekeepingPicker=!1},confirm:a.onSafekeepingConfirm}})],1)],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("发货物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.materialBatch,callback:function(t){a.$set(e,"materialBatch",t)},expression:"item.materialBatch"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.stockName,callback:function(t){a.$set(e,"stockName",t)},expression:"item.stockName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"应发数量：","label-align":"left",type:"number"},model:{value:e.materialSum,callback:function(t){a.$set(e,"materialSum",t)},expression:"item.materialSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("销售出库物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.saleActiveName,callback:function(e){a.saleActiveName=e},expression:"saleActiveName"}},a._l(a.saleMaterialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.materialBatch,callback:function(t){a.$set(e,"materialBatch",t)},expression:"item.materialBatch"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.stockName,callback:function(t){a.$set(e,"stockName",t)},expression:"item.stockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.stockPlace,callback:function(t){a.$set(e,"stockPlace",t)},expression:"item.stockPlace"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"应发数量：","label-align":"left",type:"number"},model:{value:e.materialSum,callback:function(t){a.$set(e,"materialSum",t)},expression:"item.materialSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"实发数量：","label-align":"left",type:"number",disabled:""},model:{value:e.materialActualSum,callback:function(t){a.$set(e,"materialActualSum",t)},expression:"item.materialActualSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("提交")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},B=t("VU/8")(L,I,!1,null,null,null).exports,M={data:function(){return{baseData:{printMachine:"",labelId:"4",labelName:"包装箱条码"},barcodeNumber:"",list:[],loading:!1,finished:!1,activeName:"",materialList:[],printMachines:[],labelNames:[],showPrintMachinePicker:!1,showLabelNamePicker:!1}},mounted:function(){window.scannerSearch=this.scannerSearch},created:function(){this.showLoading("正在加载数据..."),this.labelNames=[{text:"原料标签",id:"1"},{text:"产成品标签",id:"2"},{text:"小包装标签",id:"3"}],this.getPrintMachineList()},methods:{showLoading:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},getPrintMachineList:function(){var a=this;this.$api.get("/getPrintMachineList",{},function(e){(o.e.clear(),e.status>=200&&e.status<300)?"true"==e.data.success?(JSON.parse(e.data.data).some(function(e,t){a.printMachines.push({id:t,text:e.name})}),o.e.success("打印机获取成功！")):o.e.fail("打印机获取失败，请联系管理员！"):o.e.fail("打印机获取失败，请联系管理员！")})},dealBarcodeNumber:function(){var a=this;if(0!=this.barcodeNumber.length){var e=!1;this.materialList.some(function(t,s){t.materialBarcode!=a.barcodeNumber||(e=!0)}),e?o.e.fail("条码已扫描"):(o.e.loading({duration:0,message:"获取数据...",forbidClick:!0}),this.$api.get("/searchBarcodeNumber",{BarcodeNumber:this.barcodeNumber},function(e){if(a.barcodeNumber="",a.focusNextInput(),!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("数据获取异常！");if("true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);var t=JSON.parse(e.data.msg),s=a.materialList.length;t.some(function(e,t){a.$set(e,"id",s+t+1),a.$set(e,"materialBarcode",e.barcodeNumber),a.materialList.push(e)}),o.e.clear(),o.e.success("成功")}))}},onBack:function(){android.back()},onSubmit:function(){var a=this;if(o.e.loading({duration:0,message:"数据提交中...",forbidClick:!0}),0==this.baseData.printMachine.length||0==this.baseData.labelId||0==this.materialList.length)return o.e.clear(),void o.e.fail("请选择打印机、打印模板及条码数据！");var e=[];this.materialList.some(function(a,t){e.push(a.materialBarcode)}),this.$api.post("/createBoxBarcode",{mateBarcodeList:S()(e)},function(e){if(!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("数据获取异常！");if("true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);var t=e.data.msg,s=[];s.push(t),console.log(t),a.$api.post("/printBarcode",{jsonData:S()(s),printMachine:a.baseData.printMachine,labelName:a.baseData.labelId},function(a){o.e.clear(),a.status>=200&&a.status<300?"true"==a.data.success?(o.e.success(a.data.msg),android.back()):o.e.fail(a.data.msg):o.e.fail("打印机连接失败！")})})},deleteMaterial:function(){var a=this;this.materialList.some(function(e,t){if(e.id==a.activeName)return a.materialList.splice(t,1),!0})},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.dealBarcodeNumber()},onPrintMachineConfirm:function(a){this.baseData.printMachine=a.text,this.showPrintMachinePicker=!1},onLabelNameConfirm:function(a){this.baseData.labelName=a.text,this.baseData.labelId=a.id,this.showLabelNamePicker=!1},focusNextInput:function(){document.getElementsByTagName("input")[0].focus()}}},q={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{ref:"search",staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{placeholder:"请输入条码","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.dealBarcodeNumber,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.dealBarcodeNumber(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.dealBarcodeNumber},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("基本信息")]),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"打印机名称：",disabled:"",readonly:"","label-align":"left",clickable:""},on:{click:function(e){a.showPrintMachinePicker=!0}},model:{value:a.baseData.printMachine,callback:function(e){a.$set(a.baseData,"printMachine",e)},expression:"baseData.printMachine"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showPrintMachinePicker,callback:function(e){a.showPrintMachinePicker=e},expression:"showPrintMachinePicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.printMachines},on:{cancel:function(e){a.showPrintMachinePicker=!1},confirm:a.onPrintMachineConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"条码模板：",disabled:"","label-align":"left",readonly:"",clickable:""},on:{click:function(e){a.showLabelNamePicker=!1}},model:{value:a.baseData.labelName,callback:function(e){a.$set(a.baseData,"labelName",e)},expression:"baseData.labelName"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showLabelNamePicker,callback:function(e){a.showLabelNamePicker=e},expression:"showLabelNamePicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.labelNames},on:{cancel:function(e){a.showLabelNamePicker=!1},confirm:a.onLabelNameConfirm}})],1)],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("条码明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialBarcode,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料名称：",disabled:"","label-align":"left"},model:{value:e.mName,callback:function(t){a.$set(e,"mName",t)},expression:"item.mName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.mNumber,callback:function(t){a.$set(e,"mNumber",t)},expression:"item.mNumber"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"数量：","label-align":"left"},model:{value:e.mSum,callback:function(t){a.$set(e,"mSum",t)},expression:"item.mSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：",disabled:"","label-align":"left"},model:{value:e.unitName,callback:function(t){a.$set(e,"unitName",t)},expression:"item.unitName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.warehouse,callback:function(t){a.$set(e,"warehouse",t)},expression:"item.warehouse"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.position,callback:function(t){a.$set(e,"position",t)},expression:"item.position"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.batch,callback:function(t){a.$set(e,"batch",t)},expression:"item.batch"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("装箱")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},O=t("VU/8")(M,q,!1,null,null,null).exports,A={data:function(){return{baseData:{printMachine:"",labelId:"4",labelName:"包装箱条码"},barcodeNumber:"",boxBarcodeNumber:"",activeName:"",dealActiveName:"",materialList:[],dealMaterialList:[]}},mounted:function(){window.scannerSearch=this.scannerSearch},methods:{showLoading:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},dealBarcodeNumber:function(){var a=this;if(0!=this.barcodeNumber.length)if(this.barcodeNumber.length<13&&0==this.materialList.length)o.e.fail("请扫描物料包装箱条码！");else{var e=!1;if(this.dealMaterialList.some(function(t,s){t.materialBarcode!=a.barcodeNumber||(e=!0)}),e)o.e.fail("条码已扫描");else{o.e.loading({duration:0,message:"获取数据...",forbidClick:!0});var t=this.barcodeNumber;this.$api.get("/searchBarcodeNumber",{BarcodeNumber:this.barcodeNumber},function(e){if(a.barcodeNumber="",a.focusNextInput(),!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("数据获取异常！");if("true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);var s=JSON.parse(e.data.msg);if(o.e.clear(),o.e.success("条码查询成功"),t.length>13){a.materialList=[],a.dealMaterialList=[];var i=a.materialList.length;s.some(function(e,t){a.$set(e,"id",i+t+1),a.$set(e,"materialBarcode",e.barcodeNumber),a.materialList.push(e)}),a.boxBarcodeNumber=t}else{var n=!0,l="";a.materialList.some(function(a,e){if(a.barcodeNumber==t)return n=!1,void(l=a)}),n?o.e.fail("请扫描箱内物料条码！"):(l.id=a.dealMaterialList.length+1,a.dealMaterialList.push(l))}})}}},onBack:function(){android.back()},onSubmit:function(){var a=this;o.e.loading({duration:0,message:"数据提交中...",forbidClick:!0});var e=[];this.dealMaterialList.some(function(a,t){e.push(a.materialBarcode)}),this.$api.post("/modifiyBoxBarcode",{mateBarcodeList:S()(e),boxBarcodeNumber:this.boxBarcodeNumber},function(e){if(o.e.clear(),!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("数据获取异常！");if("true"==e.data.success){var t=e.data.msg;o.e.success(t),a.materialList=[],a.dealMaterialList=[]}else o.e.fail(e.data.msg)})},deleteMaterial:function(){var a=this;this.dealMaterialList.some(function(e,t){if(e.id==a.dealActiveName)return a.dealMaterialList.splice(t,1),!0})},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.dealBarcodeNumber()},focusNextInput:function(){document.getElementsByTagName("input")[0].focus()}}},U={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{ref:"search",staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{placeholder:"请输入条码","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.dealBarcodeNumber,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.dealBarcodeNumber(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.dealBarcodeNumber},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("箱条码明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialBarcode,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料名称：",disabled:"","label-align":"left"},model:{value:e.mName,callback:function(t){a.$set(e,"mName",t)},expression:"item.mName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.mNumber,callback:function(t){a.$set(e,"mNumber",t)},expression:"item.mNumber"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"数量：","label-align":"left"},model:{value:e.mSum,callback:function(t){a.$set(e,"mSum",t)},expression:"item.mSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：",disabled:"","label-align":"left"},model:{value:e.unitName,callback:function(t){a.$set(e,"unitName",t)},expression:"item.unitName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.warehouse,callback:function(t){a.$set(e,"warehouse",t)},expression:"item.warehouse"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.position,callback:function(t){a.$set(e,"position",t)},expression:"item.position"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.batch,callback:function(t){a.$set(e,"batch",t)},expression:"item.batch"}})],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("移除条码明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.dealActiveName,callback:function(e){a.dealActiveName=e},expression:"dealActiveName"}},a._l(a.dealMaterialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialBarcode,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料名称：",disabled:"","label-align":"left"},model:{value:e.mName,callback:function(t){a.$set(e,"mName",t)},expression:"item.mName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.mNumber,callback:function(t){a.$set(e,"mNumber",t)},expression:"item.mNumber"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"数量：","label-align":"left"},model:{value:e.mSum,callback:function(t){a.$set(e,"mSum",t)},expression:"item.mSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：",disabled:"","label-align":"left"},model:{value:e.unitName,callback:function(t){a.$set(e,"unitName",t)},expression:"item.unitName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.warehouse,callback:function(t){a.$set(e,"warehouse",t)},expression:"item.warehouse"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.position,callback:function(t){a.$set(e,"position",t)},expression:"item.position"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.batch,callback:function(t){a.$set(e,"batch",t)},expression:"item.batch"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("拆箱")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},R=t("VU/8")(A,U,!1,null,null,null).exports,E={data:function(){return{barcodeNumber:"",bar:"",list:[],loading:!1,finished:!1,activeName:"",materialList:[],sum:""}},methods:{dealBarcodeNumber:function(){var a=this;0!=this.barcodeNumber.length&&(o.e.loading({duration:0,message:"获取数据...",forbidClick:!0}),this.barcodeNumber.length>12?o.e.fail("请扫描物料包装条码！"):(this.bar=this.barcodeNumber,this.$api.get("/searchBarcodeNumber",{BarcodeNumber:this.barcodeNumber},function(e){if(a.barcodeNumber="",a.focusNextInput(),!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("数据获取异常！");if("true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);var t=JSON.parse(e.data.msg)[0];a.$set(t,"id",a.materialList.length+1),a.$set(t,"materialBarcode",a.bar),a.materialList=[],a.materialList.push(t),a.sum=t.mSum,o.e.clear(),o.e.success("成功")})))},onBack:function(){android.back()},onSubmit:function(){if(this.materialList[0].mSum>this.sum)o.e.fail("拆包后数量不得超过初始数量！");else{o.e.loading({duration:0,message:"数据提交中...",forbidClick:!0});var a=[];this.materialList.some(function(e,t){a.push(e.materialBarcode)}),this.$api.post("/updateBarcode",{BarcodeNumber:this.bar,mSum:this.materialList[0].mSum},function(a){return a.status>=200&&a.status<300?"true"!=a.data.success?(o.e.clear(),void o.e.fail(a.data.msg)):(o.e.clear(),o.e.success(a.data.msg),void android.back()):(o.e.clear(),void o.e.fail("数据获取异常！"))})}},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.dealBarcodeNumber()},focusNextInput:function(){document.getElementsByTagName("input")[0].focus()}}},z={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{placeholder:"请输入条码","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.dealBarcodeNumber,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.dealBarcodeNumber(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.dealBarcodeNumber},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("条码明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialBarcode,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.mNumber,callback:function(t){a.$set(e,"mNumber",t)},expression:"item.mNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料名称：",disabled:"","label-align":"left"},model:{value:e.mName,callback:function(t){a.$set(e,"mName",t)},expression:"item.mName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"数量：","label-align":"left"},model:{value:e.mSum,callback:function(t){a.$set(e,"mSum",t)},expression:"item.mSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：",disabled:"","label-align":"left"},model:{value:e.unitName,callback:function(t){a.$set(e,"unitName",t)},expression:"item.unitName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.warehouse,callback:function(t){a.$set(e,"warehouse",t)},expression:"item.warehouse"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.position,callback:function(t){a.$set(e,"position",t)},expression:"item.position"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.batch,callback:function(t){a.$set(e,"batch",t)},expression:"item.batch"}})],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("拆包")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},W=t("VU/8")(E,z,!1,null,null,null).exports,F=t("MICi"),Q=t.n(F),T={data:function(){return{barcodeNumber:"",baseData:{dept:"",deptId:"",customer:"",customerId:"",sourceType:"",sourceTypeId:"",menuNumber:"",requester:"",requesterId:"",consignor:"",consignorId:"",purpose:""},activeName:"",materialList:[],showDeptsPicker:!1,depts:[],showCustomersPicker:!1,customers:[],showSourceTypesPicker:!1,sourceTypes:[],showMenuNumbersPicker:!1,menuNumbers:[],showRequestersPicker:!1,requesters:[],showConsignorsPicker:!1,consignors:[],showStocksPicker:!1,stocks:[],showStockPlacesPicker:!1,stockPlaces:[]}},created:function(){this.searchAllInfo()},mounted:function(){window.scannerSearch=this.scannerSearch},methods:{showLoading:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},searchAllInfo:function(){var a=this;this.showLoading("正在获取数据..."),this.$api.get("/selectAllInfo",{},function(e){if(o.e.clear(),e.status>=200&&e.status<300)if("true"==e.data.success){var t=e.data.data;a.depts=t.deptInfo,a.customers=t.customerInfo,a.requesters=t.empInfo,a.consignors=t.empInfo,a.stockPlaces=t.stockPlaceInfo,a.stocks=t.stockInfo,o.e.success("数据获取成功")}else o.e.fail(e.data.msg);else o.e.fail("数据获取异常")})},onSubmit:function(){if(0!=this.baseData.requesterId.length&&0!=this.baseData.consignorId.length)if(0!=this.materialList.length){var a=!0;this.materialList.some(function(e,t){if(!e.totalPrice||e.totalPrice<=0||0==e.warehouse.length)return o.e.fail("请确认物料信息"),a=!1,!0}),a&&this.$api.post("/submitMiscellaneousIssue",{baseData:S()(this.baseData),materialList:S()(this.materialList)},function(a){o.e.clear(),a.status>=200&&a.status<300?"true"==a.data.success?(o.e.success("数据提交成功"),android.back()):o.e.fail(a.data.msg):o.e.fail("数据提交异常！")})}else o.e.fail("请输入物料");else o.e.fail("请填写必填项")},onBack:function(){android.back()},onDeptsConfirm:function(a){this.baseData.dept=a.text,this.baseData.deptId=a.id,this.showDeptsPicker=!1},onCustomerConfirm:function(a){this.baseData.customer=a.text,this.baseData.customerId=a.id,this.showCustomersPicker=!1},onSourceTypeConfirm:function(a){this.baseData.sourceType=a.text,this.baseData.sourceTypeId=a.id,this.showSourceTypesPicker=!1,this.menuNumbers=[{id:1,text:"1231"},{id:2,text:"4123"}]},onMenuNumberConfirm:function(a){this.baseData.menuNumber=a.text,this.showMenuNumbersPicker=!1},onRequesterConfirm:function(a){this.baseData.requester=a.text,this.baseData.requesterId=a.id,this.showRequestersPicker=!1},onConsignorConfirm:function(a){this.baseData.consignor=a.text,this.baseData.consignorId=a.id,this.showConsignorsPicker=!1},onStocksConfirm:function(a){var e=this;this.materialList.some(function(t,s){e.activeName==t.id&&(e.$set(t,"warehouse",a.text),e.$set(t,"warehouseId",a.id))}),this.showStocksPicker=!1},onStockPlacesConfirm:function(a){var e=this;this.materialList.some(function(t,s){e.activeName==t.id&&(e.$set(t,"position",a.text),e.$set(t,"positionId",a.id))}),this.showStockPlacesPicker=!1},deleteMaterial:function(){var a=this;this.materialList.some(function(e,t){if(e.id==a.activeName)return a.materialList.splice(t,1),!0}),this.materialList.some(function(e,t){a.$set(e,"id",t)}),this.activeName=""},onSearch:function(){var a=this;0!=this.barcodeNumber.length&&(this.showLoading("正在获取数据..."),this.$api.get("/searchBarcodeInfo",{BarcodeNumber:this.barcodeNumber},function(e){(o.e.clear(),a.barcodeNumber="",a.focusNextInput(),e.status>=200&&e.status<300)?"true"==e.data.success?(o.e.success("条码查询成功"),JSON.parse(e.data.msg).some(function(e,t){var s=!0;a.materialList.some(function(t,i){if(e.mId==t.mId&&e.batch==t.batch&&e.warehouseId==t.warehouseId&&e.positionId==t.positionId)return a.$set(t,"mSum",parseInt(t.mSum)+parseInt(e.mSum)),null!=t.price&&t.price.length>0&&a.$set(t,"totalPrice",parseInt(t.mSum)*parseInt(t.price)),s=!1,a.activeName=t.id,!0}),s&&(a.$set(e,"id",a.materialList.length+1),a.materialList.push(e),a.activeName=a.materialList.length)})):o.e.fail(e.data.msg):o.e.fail("数据获取异常")}))},setTotalPrice:function(a){var e=parseInt(a.price)*parseInt(a.mSum);Q()(e)&&(e=0),this.$set(a,"totalPrice",e)},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.onSearch()},focusNextInput:function(){document.getElementsByTagName("input")[0].focus()}}},j={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{attrs:{placeholder:"","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearch(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("基本信息")]),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"领料部门：",disabled:"","label-align":"left"},on:{click:function(e){a.showDeptsPicker=!0}},model:{value:a.baseData.dept,callback:function(e){a.$set(a.baseData,"dept",e)},expression:"baseData.dept"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showDeptsPicker,callback:function(e){a.showDeptsPicker=e},expression:"showDeptsPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.depts},on:{cancel:function(e){a.showDeptsPicker=!1},confirm:a.onDeptsConfirm}})],1)],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"客户：",disabled:"","label-align":"left",readonly:"",clickable:""},on:{click:function(e){a.showCustomersPicker=!0}},model:{value:a.baseData.customer,callback:function(e){a.$set(a.baseData,"customer",e)},expression:"baseData.customer"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showCustomersPicker,callback:function(e){a.showCustomersPicker=e},expression:"showCustomersPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.customers},on:{cancel:function(e){a.showCustomersPicker=!1},confirm:a.onCustomerConfirm}})],1)],1)],1),a._v(" "),a._e(),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"领料人：",disabled:"","label-align":"left"},on:{click:function(e){a.showRequestersPicker=!0}},model:{value:a.baseData.requester,callback:function(e){a.$set(a.baseData,"requester",e)},expression:"baseData.requester"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showRequestersPicker,callback:function(e){a.showRequestersPicker=e},expression:"showRequestersPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.requesters},on:{cancel:function(e){a.showRequestersPicker=!1},confirm:a.onRequesterConfirm}})],1)],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"发货人：","label-align":"left",disabled:""},on:{click:function(e){a.showConsignorsPicker=!0}},model:{value:a.baseData.consignor,callback:function(e){a.$set(a.baseData,"consignor",e)},expression:"baseData.consignor"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showConsignorsPicker,callback:function(e){a.showConsignorsPicker=e},expression:"showConsignorsPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.consignors},on:{cancel:function(e){a.showConsignorsPicker=!1},confirm:a.onConsignorConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"领料用途：","label-align":"left",autosize:"",rows:"1",type:"textarea"},model:{value:a.baseData.purpose,callback:function(e){a.$set(a.baseData,"purpose",e)},expression:"baseData.purpose"}})],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.mName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.mNumber,callback:function(t){a.$set(e,"mNumber",t)},expression:"item.mNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.batch,callback:function(t){a.$set(e,"batch",t)},expression:"item.batch"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"仓库：",disabled:"","label-align":"left"},on:{click:function(e){a.showStocksPicker=!0}},model:{value:e.warehouse,callback:function(t){a.$set(e,"warehouse",t)},expression:"item.warehouse"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showStocksPicker,callback:function(e){a.showStocksPicker=e},expression:"showStocksPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.stocks},on:{cancel:function(e){a.showStocksPicker=!1},confirm:a.onStocksConfirm}})],1)],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},on:{click:function(e){a.showStockPlacesPicker=!0}},model:{value:e.position,callback:function(t){a.$set(e,"position",t)},expression:"item.position"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showStockPlacesPicker,callback:function(e){a.showStockPlacesPicker=e},expression:"showStockPlacesPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.stockPlaces},on:{cancel:function(e){a.showStockPlacesPicker=!1},confirm:a.onStockPlacesConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"申请数量：","label-align":"left",type:"number"},on:{change:function(t){return a.setTotalPrice(e)}},model:{value:e.mSum,callback:function(t){a.$set(e,"mSum",t)},expression:"item.mSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"单价：","label-align":"left",type:"number"},on:{change:function(t){return a.setTotalPrice(e)}},model:{value:e.price,callback:function(t){a.$set(e,"price",t)},expression:"item.price"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{disabled:"",label:"金额：","label-align":"left",type:"number"},model:{value:e.totalPrice,callback:function(t){a.$set(e,"totalPrice",t)},expression:"item.totalPrice"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("提交")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},J=t("VU/8")(T,j,!1,null,null,null).exports,K={data:function(){return{barcodeNumber:"",baseData:{dept:"",deptId:"",customer:"",customerId:"",sourceType:"",sourceTypeId:"",menuNumber:"",requester:"",requesterId:"",consignor:"",consignorId:"",purpose:""},activeName:"",materialList:[],barcodeActiveName:"",barcodeList:[],showDeptsPicker:!1,depts:[],showCustomersPicker:!1,customers:[],showSourceTypesPicker:!1,sourceTypes:[],showMenuNumbersPicker:!1,menuNumbers:[],showRequestersPicker:!1,requesters:[],showConsignorsPicker:!1,consignors:[],showStocksPicker:!1,stocks:[],showStockPlacesPicker:!1,stockPlaces:[]}},created:function(){this.searchAllInfo()},mounted:function(){window.scannerSearch=this.scannerSearch},methods:{showLoading:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},searchAllInfo:function(){var a=this;this.showLoading("正在获取数据..."),this.$api.get("/selectAllInfo",{},function(e){if(o.e.clear(),e.status>=200&&e.status<300)if("true"==e.data.success){var t=e.data.data;a.depts=t.deptInfo,a.customers=t.supplierInfo,a.requesters=t.empInfo,a.consignors=t.empInfo,a.stockPlaces=t.stockPlaceInfo,a.stocks=t.stockInfo,o.e.success("数据获取成功")}else o.e.fail(e.data.msg);else o.e.fail("数据获取异常")})},onSubmit:function(){if(0!=this.baseData.requesterId.length&&0!=this.baseData.consignorId.length)if(0!=this.materialList.length){var a=!0;this.materialList.some(function(e,t){if(!e.totalPrice||e.totalPrice<=0||0==e.warehouse.length)return o.e.fail("请确认物料信息"),a=!1,!0}),a&&this.$api.post("/submitMiscellaneousReceipt",{baseData:S()(this.baseData),materialList:S()(this.materialList),barcodeList:S()(this.barcodeList)},function(a){o.e.clear(),a.status>=200&&a.status<300?"true"==a.data.success?(o.e.success("数据提交成功"),android.back()):o.e.fail(a.data.msg):o.e.fail("数据提交异常！")})}else o.e.fail("请输入物料");else o.e.fail("请填写必填项")},onBack:function(){android.back()},onDeptsConfirm:function(a){this.baseData.dept=a.text,this.baseData.deptId=a.id,this.showDeptsPicker=!1},onCustomerConfirm:function(a){this.baseData.customer=a.text,this.baseData.customerId=a.id,this.showCustomersPicker=!1},onSourceTypeConfirm:function(a){this.baseData.sourceType=a.text,this.baseData.sourceTypeId=a.id,this.showSourceTypesPicker=!1,this.menuNumbers=[{id:1,text:"1231"},{id:2,text:"4123"}]},onMenuNumberConfirm:function(a){this.baseData.menuNumber=a.text,this.showMenuNumbersPicker=!1},onRequesterConfirm:function(a){this.baseData.requester=a.text,this.baseData.requesterId=a.id,this.showRequestersPicker=!1},onConsignorConfirm:function(a){this.baseData.consignor=a.text,this.baseData.consignorId=a.id,this.showConsignorsPicker=!1},onStocksConfirm:function(a){var e=this;this.materialList.some(function(t,s){e.activeName==t.id&&(e.$set(t,"warehouse",a.text),e.$set(t,"warehouseId",a.id))}),this.showStocksPicker=!1},onStockPlacesConfirm:function(a){var e=this;this.materialList.some(function(t,s){e.activeName==t.id&&(e.$set(t,"position",a.text),e.$set(t,"positionId",a.id))}),this.showStockPlacesPicker=!1},deleteBarcode:function(){var a=this;this.barcodeList.some(function(e,t){if(e.id==a.barcodeActiveName){a.barcodeList.splice(t,1);var s=!1;return a.materialList.some(function(t,i){if(t.mId==e.mId&&t.batch==e.batch&&t.warehouseId==e.warehouseId&&t.positionId==e.positionId){var n=parseInt(t.mSum)-parseInt(e.mSum);return 0==parseInt(n)?(a.materialList.splice(i,1),s=!0):(a.$set(t,"mSum",n),a.$set(t,"totalPrice",parseInt(t.mSum)*parseInt(t.price))),!0}}),s&&a.materialList.some(function(e,t){a.$set(e,"id",t)}),!0}}),this.barcodeList.some(function(e,t){a.$set(e,"id",t)}),this.barcodeActiveName=""},onSearch:function(){var a=this;if(0!=this.barcodeNumber.length){var e=!1;this.barcodeList.some(function(t,s){if(t.barcodeNumber==a.barcodeNumber)return e=!0,!0}),e?o.e.fail("条码已扫描"):(this.showLoading("正在获取数据..."),this.$api.get("/searchBarcodeInfo",{BarcodeNumber:this.barcodeNumber},function(e){(o.e.clear(),a.barcodeNumber="",a.focusNextInput(),e.status>=200&&e.status<300)?"true"==e.data.success?(o.e.success("条码查询成功"),JSON.parse(e.data.msg).some(function(e,t){e.positionId=a.baseData.stockPlaceID,e.position=a.baseData.stockPlace;var s=JSON.parse(S()(e));s.id=a.barcodeList.length+1,a.barcodeList.push(s);var i=!0;a.materialList.some(function(t,s){if(e.mId==t.mId&&e.batch==t.batch&&e.warehouseId==t.warehouseId&&e.positionId==t.positionId)return a.$set(t,"mSum",parseInt(t.mSum)+parseInt(e.mSum)),null!=t.price&&t.price.length>0&&a.$set(t,"totalPrice",parseInt(t.mSum)*parseInt(t.price)),i=!1,a.activeName=t.id,!0}),i&&(a.$set(e,"id",a.materialList.length+1),a.materialList.push(e),a.activeName=a.materialList.length)})):o.e.fail(e.data.msg):o.e.fail("数据获取异常")}))}},onSearchPlace:function(){var a=this;0!=this.baseData.stockPlace.length&&(this.showLoading("正在获取仓位..."),this.$api.get("/searchStockPlaceInfo",{stockplaceNumber:this.baseData.stockPlace},function(e){if(a.baseData.stockPlace="",o.e.clear(),e.status>=200&&e.status<300)if("true"==e.data.success){o.e.success("仓位获取成功");var t=JSON.parse(e.data.data);a.baseData.stockPlace=t.text,a.baseData.stockPlaceID=t.id}else o.e.fail(e.data.msg);else o.e.fail("数据获取异常")}))},setTotalPrice:function(a){var e=parseInt(a.price)*parseInt(a.mSum);Q()(e)&&(e=0),this.$set(a,"totalPrice",e)},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.onSearch()},focusNextInput:function(){document.getElementsByTagName("input")[0].focus()}}},V={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{attrs:{placeholder:"","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearch(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("基本信息")]),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"部门：",disabled:"","label-align":"left"},on:{click:function(e){a.showDeptsPicker=!0}},model:{value:a.baseData.dept,callback:function(e){a.$set(a.baseData,"dept",e)},expression:"baseData.dept"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showDeptsPicker,callback:function(e){a.showDeptsPicker=e},expression:"showDeptsPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.depts},on:{cancel:function(e){a.showDeptsPicker=!1},confirm:a.onDeptsConfirm}})],1)],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"供应商：",disabled:"","label-align":"left",readonly:"",clickable:""},on:{click:function(e){a.showCustomersPicker=!0}},model:{value:a.baseData.customer,callback:function(e){a.$set(a.baseData,"customer",e)},expression:"baseData.customer"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showCustomersPicker,callback:function(e){a.showCustomersPicker=e},expression:"showCustomersPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.customers},on:{cancel:function(e){a.showCustomersPicker=!1},confirm:a.onCustomerConfirm}})],1)],1)],1),a._v(" "),a._e(),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"验收：",disabled:"","label-align":"left"},on:{click:function(e){a.showRequestersPicker=!0}},model:{value:a.baseData.requester,callback:function(e){a.$set(a.baseData,"requester",e)},expression:"baseData.requester"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showRequestersPicker,callback:function(e){a.showRequestersPicker=e},expression:"showRequestersPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.requesters},on:{cancel:function(e){a.showRequestersPicker=!1},confirm:a.onRequesterConfirm}})],1)],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"保管：","label-align":"left",disabled:""},on:{click:function(e){a.showConsignorsPicker=!0}},model:{value:a.baseData.consignor,callback:function(e){a.$set(a.baseData,"consignor",e)},expression:"baseData.consignor"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showConsignorsPicker,callback:function(e){a.showConsignorsPicker=e},expression:"showConsignorsPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.consignors},on:{cancel:function(e){a.showConsignorsPicker=!1},confirm:a.onConsignorConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"摘要：","label-align":"left",autosize:"",rows:"1",type:"textarea"},model:{value:a.baseData.purpose,callback:function(e){a.$set(a.baseData,"purpose",e)},expression:"baseData.purpose"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"当前仓位：","label-align":"left"},on:{keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearchPlace(e)}},model:{value:a.baseData.stockPlace,callback:function(e){a.$set(a.baseData,"stockPlace",e)},expression:"baseData.stockPlace"}})],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.mName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.mNumber,callback:function(t){a.$set(e,"mNumber",t)},expression:"item.mNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.batch,callback:function(t){a.$set(e,"batch",t)},expression:"item.batch"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"仓库：",disabled:"","label-align":"left"},on:{click:function(e){a.showStocksPicker=!1}},model:{value:e.warehouse,callback:function(t){a.$set(e,"warehouse",t)},expression:"item.warehouse"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showStocksPicker,callback:function(e){a.showStocksPicker=e},expression:"showStocksPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.stocks},on:{cancel:function(e){a.showStocksPicker=!1},confirm:a.onStocksConfirm}})],1)],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},on:{click:function(e){a.showStockPlacesPicker=!1}},model:{value:e.position,callback:function(t){a.$set(e,"position",t)},expression:"item.position"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showStockPlacesPicker,callback:function(e){a.showStockPlacesPicker=e},expression:"showStockPlacesPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.stockPlaces},on:{cancel:function(e){a.showStockPlacesPicker=!1},confirm:a.onStockPlacesConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"申请数量：","label-align":"left",type:"number"},on:{change:function(t){return a.setTotalPrice(e)}},model:{value:e.mSum,callback:function(t){a.$set(e,"mSum",t)},expression:"item.mSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"单价：","label-align":"left",type:"number"},on:{change:function(t){return a.setTotalPrice(e)}},model:{value:e.price,callback:function(t){a.$set(e,"price",t)},expression:"item.price"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"金额：","label-align":"left",type:"number"},model:{value:e.totalPrice,callback:function(t){a.$set(e,"totalPrice",t)},expression:"item.totalPrice"}})],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("条码明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.barcodeActiveName,callback:function(e){a.barcodeActiveName=e},expression:"barcodeActiveName"}},a._l(a.barcodeList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.barcodeNumber,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.mNumber,callback:function(t){a.$set(e,"mNumber",t)},expression:"item.mNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.batch,callback:function(t){a.$set(e,"batch",t)},expression:"item.batch"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.warehouse,callback:function(t){a.$set(e,"warehouse",t)},expression:"item.warehouse"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.position,callback:function(t){a.$set(e,"position",t)},expression:"item.position"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"数量：","label-align":"left",type:"number",disabled:""},model:{value:e.mSum,callback:function(t){a.$set(e,"mSum",t)},expression:"item.mSum"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteBarcode}},[a._v("删除")])],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("提交")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},G=t("VU/8")(K,V,!1,null,null,null).exports,H={data:function(){return{processNo:"",list:[],loading:!1,finished:!1}},methods:{onLoad:function(){this.onSearch()},mounted:function(){window.scannerSearch=this.scannerSearch},onSearch:function(){var a=this;o.e.loading({duration:0,message:"加载中...",forbidClick:!0}),this.$api.get("/auxCheck/getAuxCheckList",{processNo:this.processNo},function(e){o.e.clear(),e.status>=200&&e.status<300?"true"==e.data.success?a.list=e.data.msg:o.e.fail(e.data.msg):o.e.fail("获取数据时出现异常，请重新操作")}),this.finished=!0},updateAuxCheck:function(a){this.$router.push({path:"/auxCheck",query:{number:a}})},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.processNo=a,this.onSearch()}}},X={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",[t("van-search",{staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{placeholder:"请输入盘点方案编码","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch},model:{value:a.processNo,callback:function(e){a.processNo=e},expression:"processNo"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)]),a._v(" "),t("van-list",{staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{finished:a.finished,"finished-text":"没有更多了"},on:{load:a.onLoad},model:{value:a.loading,callback:function(e){a.loading=e},expression:"loading"}},a._l(a.list,function(e){return t("van-cell",{key:e,attrs:{title:e},on:{click:function(t){return a.updateAuxCheck(e)}}})}),1)],1)},staticRenderFns:[]},Y=t("VU/8")(H,X,!1,null,null,null).exports,Z={data:function(){return{barcodeNumber:"",baseData:{auxCheckNo:""},activeName:"",materialList:[],notInMaterialList:[]}},created:function(){this.baseData.auxCheckNo=this.$route.query.number,this.searchAuxCheckInfo()},mounted:function(){window.scannerSearch=this.scannerSearch},methods:{showLoading:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},searchAuxCheckInfo:function(){var a=this;this.showLoading("正在获取数据..."),this.$api.get("/auxCheck/getAuxCheckData",{auxCheckNo:this.$route.query.number},function(e){return e.status>=200&&e.status<300?"true"!=e.data.success?(o.e.fail(e.data.msg),void o.e.clear()):(a.materialList=e.data.data,void o.e.clear()):(o.e.fail("数据获取异常！"),void o.e.clear())})},onSubmit:function(){this.submit()},submit:function(){o.e.loading({duration:0,message:"正在提交数据...",forbidClick:!0}),this.$api.post("/auxCheck/updateAuxCheckData",{auxCheckNo:this.baseData.auxCheckNo,notInMaterialList:S()(this.notInMaterialList),materialList:S()(this.materialList)},function(a){return a.status>=200&&a.status<300?"true"!=a.data.success?(o.e.clear(),void o.e.fail(a.data.msg)):(o.e.success(a.data.msg),void android.back()):(o.e.clear(),void o.e.fail("数据提交异常！"))})},onBack:function(){this.$router.go(-1)},onSearch:function(){var a=this;this.$api.get("/searchAuxBarcodeNumber",{BarcodeNumber:this.barcodeNumber},function(e){if(!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("条码查询异常！");if("true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);o.e.success("条码查询成功");var t=e.data.msg,s=!0;if(a.materialList.some(function(a,e){if(a.materialID==t.materialID&&a.batchNumber==t.batchNumber&&a.stockID==t.stockID&&a.stockPlaceID==t.stockPlaceID)return a.auxCheckQty=Number(a.auxCheckQty)+Number(t.auxCheckQty),void(s=!1)}),s){var i=!0;a.notInMaterialList.some(function(a,e){if(a.materialID==t.materialID&&a.batchNumber==t.batchNumber&&a.stockID==t.stockID&&a.stockPlaceID==t.stockPlaceID)return a.auxCheckQty=Number(a.auxCheckQty)+Number(t.auxCheckQty),void(i=!1)}),i&&(a.$set(t,"qtyAct","0"),a.notInMaterialList.push(t))}})},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.onSearch()}}},aa={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{attrs:{placeholder:"","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearch(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("基本信息")]),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"盘点单号：",disabled:"","label-align":"left"},model:{value:a.baseData.auxCheckNo,callback:function(e){a.$set(a.baseData,"auxCheckNo",e)},expression:"baseData.auxCheckNo"}})],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("账存物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialCode,callback:function(t){a.$set(e,"materialCode",t)},expression:"item.materialCode"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.batchNumber,callback:function(t){a.$set(e,"batchNumber",t)},expression:"item.batchNumber"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.stockName,callback:function(t){a.$set(e,"stockName",t)},expression:"item.stockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.stockPlaceName,callback:function(t){a.$set(e,"stockPlaceName",t)},expression:"item.stockPlaceName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"账存数量：","label-align":"left",type:"number"},model:{value:e.qtyAct,callback:function(t){a.$set(e,"qtyAct",t)},expression:"item.qtyAct"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.unitName,callback:function(t){a.$set(e,"unitName",t)},expression:"item.unitName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"盘点数量：","label-align":"left",type:"number"},model:{value:e.auxCheckQty,callback:function(t){a.$set(e,"auxCheckQty",t)},expression:"item.auxCheckQty"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.unitName,callback:function(t){a.$set(e,"unitName",t)},expression:"item.unitName"}})],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("非账存物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.notInMaterialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialCode,callback:function(t){a.$set(e,"materialCode",t)},expression:"item.materialCode"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.batchNumber,callback:function(t){a.$set(e,"batchNumber",t)},expression:"item.batchNumber"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.stockName,callback:function(t){a.$set(e,"stockName",t)},expression:"item.stockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.stockPlaceName,callback:function(t){a.$set(e,"stockPlaceName",t)},expression:"item.stockPlaceName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"账存数量：","label-align":"left",type:"number"},model:{value:e.qtyAct,callback:function(t){a.$set(e,"qtyAct",t)},expression:"item.qtyAct"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.unitName,callback:function(t){a.$set(e,"unitName",t)},expression:"item.unitName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"盘点数量：","label-align":"left",type:"number"},model:{value:e.auxCheckQty,callback:function(t){a.$set(e,"auxCheckQty",t)},expression:"item.auxCheckQty"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.unitName,callback:function(t){a.$set(e,"unitName",t)},expression:"item.unitName"}})],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("提交")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},ea=t("VU/8")(Z,aa,!1,null,null,null).exports,ta={data:function(){return{barcodeNumber:"",NbarcodeNumber:"",baseData:{},activeName:"",newActiveName:"",showSalesWayPicker:!1,salesWays:[],showShipperPicker:!1,shippers:[],showSafekeepingPicker:!1,Safekeepings:[],materialList:[],newMaterialList:[],barcodeList:[]}},created:function(){var a=this;this.showLoading("正在加载...");var e=this.$route.query.data;this.baseData.fposname=e[0].fposname,this.baseData.fSupplyID=e[0].fSupplyID,this.baseData.fsupplyname=e[0].fsupplyname,this.baseData.fDeptID=e[0].fDeptID,this.baseData.fdeptName=e[0].fdeptName,this.baseData.fEmpID=e[0].fEmpID,this.baseData.fempName=e[0].fempName,this.baseData.salesMan=e[0].salesMan,this.baseData.salesManId=e[0].salesManId,this.baseData.shipper=e[0].shipper,this.baseData.shipperId=e[0].shipperId,this.baseData.fstockName=e[0].fstockName,this.baseData.fBillId=android.getUserID(),e.some(function(e,t){e.materialList.some(function(e,t){a.materialList.push(e)})}),this.$api.get("/selectAllEmpInfo",{},function(e){o.e.clear(),e.status>=200&&e.status<300?"true"==e.data.success?(a.shippers=e.data.data,a.Safekeepings=e.data.data,o.e.success("数据获取成功")):o.e.fail(e.data.msg):o.e.fail("数据获取异常！")})},methods:{showLoading:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},onSubmit:function(){this.showLoading("正在提交数据..."),this.$api.post("/submitPurchaseReceipt",{baseData:S()(this.baseData),materialList:S()(this.newMaterialList),barcodeList:S()(this.barcodeList)},function(a){if(o.e.clear(),!(a.status>=200&&a.status<300))return o.e.fail("数据提交异常！"),void console.log(a);"true"==a.data.success?(o.e.success("数据提交成功"),android.back()):o.e.fail(a.data.msg)})},onBack:function(){this.$router.go(-1)},onSalesWayConfirm:function(a){this.baseData.salesWay=a.text,this.baseData.salesWayId=a.id,this.showSalesWayPicker=!1},onShipperConfirm:function(a){this.baseData.shipper=a.text,this.baseData.shipperId=a.id,this.showShipperPicker=!1},onSafekeepingConfirm:function(a){this.baseData.safeKeeping=a.text,this.baseData.safeKeepingId=a.id,this.showSafekeepingPicker=!1},deleteMaterial:function(){var a=this;this.newMaterialList.some(function(e,t){if(e.id==a.newActiveName)return a.newMaterialList.splice(t,1),a.barcodeList.some(function(s,i){e.NbarcodeNumber==s.barcodeNumber&&a.barcodeList.splice(t,1)}),!0})},onSearch:function(){var a=this;if(0!=this.barcodeNumber.length){var e=!0;this.barcodeList.some(function(t,s){if(t.barcodeNumber==a.barcodeNumber)return o.e.fail("条码已扫描"),void(e=!1)}),e&&this.$api.get("/searchBarcodeNumber",{BarcodeNumber:this.barcodeNumber,id:"2"},function(e){if(a.barcodeNumber="",a.focusNextInput(),!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("条码查询异常！");if("true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);o.e.success("条码查询成功");var t=JSON.parse(e.data.msg);a.materialList.some(function(e,s){"*"==e.stockPlace&&(e.stockPlace=""),t.some(function(t,s){var i=!1,n=e.zbm.split("-");Number(e.fQty);var l=Number(n[0]),o=Number(n[0])+Number(e.fQty)-1,r=Number(t.zBM);if(r>=l&&r<=o&&(i=!0),e.materialNumber==t.mNumber&&e.fBatchNo==t.batch&&e.fstockName==t.warehouse&&i){var c=JSON.parse(S()(e));c.id=a.newMaterialList.length+1,c.materialActualSum=Number(t.mSum),c.fstockPlaceName=a.baseData.stockPlace,c.fstockPlaceId=a.baseData.stockPlaceID,c.NbarcodeNumber=t.barcodeNumber,c.zbm=t.zBM,a.newMaterialList.push(c),a.newActiveName=c.id,a.barcodeList.push(t)}})})})}},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.onSearch()},onSearchPlace:function(){var a=this;0!=this.baseData.stockPlace.length&&(this.showLoading("正在获取仓位..."),this.$api.get("/searchStockPlaceInfo",{stockplaceNumber:this.baseData.stockPlace},function(e){if(a.baseData.stockPlace="",o.e.clear(),e.status>=200&&e.status<300)if("true"==e.data.success){o.e.success("仓位获取成功");var t=JSON.parse(e.data.data);a.baseData.stockPlace=t.text,a.baseData.stockPlaceID=t.id}else o.e.fail(e.data.msg);else o.e.fail("数据获取异常")}))},focusNextInput:function(){document.getElementsByTagName("input")[0].focus()}}},sa={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{attrs:{placeholder:"","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearch(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("基本信息")]),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"采购方式：",disabled:"","label-align":"left",readonly:"",clickable:""},on:{click:function(e){a.showSalesWayPicker=!1}},model:{value:a.baseData.fposname,callback:function(e){a.$set(a.baseData,"fposname",e)},expression:"baseData.fposname"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showSalesWayPicker,callback:function(e){a.showSalesWayPicker=e},expression:"showSalesWayPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.salesWays},on:{cancel:function(e){a.showSalesWayPicker=!1},confirm:a.onSalesWayConfirm}})],1)],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"供应商：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fsupplyname,callback:function(e){a.$set(a.baseData,"fsupplyname",e)},expression:"baseData.fsupplyname"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"部门：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fdeptName,callback:function(e){a.$set(a.baseData,"fdeptName",e)},expression:"baseData.fdeptName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"保管：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showSafekeepingPicker=!0}},model:{value:a.baseData.safeKeeping,callback:function(e){a.$set(a.baseData,"safeKeeping",e)},expression:"baseData.safeKeeping"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showSafekeepingPicker,callback:function(e){a.showSafekeepingPicker=e},expression:"showSafekeepingPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.Safekeepings},on:{cancel:function(e){a.showSafekeepingPicker=!1},confirm:a.onSafekeepingConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"业务员：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fempName,callback:function(e){a.$set(a.baseData,"fempName",e)},expression:"baseData.fempName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"验收：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showShipperPicker=!0}},model:{value:a.baseData.shipper,callback:function(e){a.$set(a.baseData,"shipper",e)},expression:"baseData.shipper"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showShipperPicker,callback:function(e){a.showShipperPicker=e},expression:"showShipperPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.shippers},on:{cancel:function(e){a.showShipperPicker=!1},confirm:a.onShipperConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"当前仓位：","label-align":"left"},on:{keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearchPlace(e)}},model:{value:a.baseData.stockPlace,callback:function(e){a.$set(a.baseData,"stockPlace",e)},expression:"baseData.stockPlace"}})],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.fBatchNo,callback:function(t){a.$set(e,"fBatchNo",t)},expression:"item.fBatchNo"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.fstockName,callback:function(t){a.$set(e,"fstockName",t)},expression:"item.fstockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.fstockNumber,callback:function(t){a.$set(e,"fstockNumber",t)},expression:"item.fstockNumber"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"应收数量：","label-align":"left",type:"number"},model:{value:e.fQty,callback:function(t){a.$set(e,"fQty",t)},expression:"item.fQty"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"自编码：","label-align":"left"},model:{value:e.zbm,callback:function(t){a.$set(e,"zbm",t)},expression:"item.zbm"}})],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("扫描物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.newActiveName,callback:function(e){a.newActiveName=e},expression:"newActiveName"}},a._l(a.newMaterialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.fBatchNo,callback:function(t){a.$set(e,"fBatchNo",t)},expression:"item.fBatchNo"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.fstockName,callback:function(t){a.$set(e,"fstockName",t)},expression:"item.fstockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.fstockPlaceName,callback:function(t){a.$set(e,"fstockPlaceName",t)},expression:"item.fstockPlaceName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"应收数量：","label-align":"left",type:"number"},model:{value:e.fQty,callback:function(t){a.$set(e,"fQty",t)},expression:"item.fQty"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"实收数量：",disabled:"","label-align":"left",type:"number"},model:{value:e.materialActualSum,callback:function(t){a.$set(e,"materialActualSum",t)},expression:"item.materialActualSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"自编码：","label-align":"left",disabled:""},model:{value:e.zbm,callback:function(t){a.$set(e,"zbm",t)},expression:"item.zbm"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"条码编号：","label-align":"left",disabled:""},model:{value:e.NbarcodeNumber,callback:function(t){a.$set(e,"NbarcodeNumber",t)},expression:"item.NbarcodeNumber"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("提交")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},ia=t("VU/8")(ta,sa,!1,null,null,null).exports,na=t("bOdI"),la=t.n(na),oa=t("mtWM"),ra=t.n(oa),ca={data:function(){var a;return a={barcodeNumber:"",NbarcodeNumber:"",baseData:{},QCBaseData:{},activeName:"",newActiveName:"",showSalesWayPicker:!1,salesWays:[],showShipperPicker:!1,shippers:[],showSafekeepingPicker:!1,Safekeepings:[],materialList:[],newMaterialList:[],barcodeList:[],columns:["合格","不合格"],showIsOkPicker:!1,showMIsOkPicker:!1},la()(a,"showShipperPicker",!1),la()(a,"shippers",[]),la()(a,"showSafekeepingPicker",!1),la()(a,"Safekeepings",[]),la()(a,"fileList",[]),a},created:function(){var a=this;this.showLoading("正在加载...");var e=this.$route.query.data,t=this.$route.query.mate;this.baseData.fposname="外购入库",this.baseData.fSupplyID=e[0].fSupplyID,this.baseData.fsupplyname=e[0].fsupplyname,this.baseData.fmateNum=t.materialNumber,this.baseData.fmateName=t.materialName,this.baseData.fBatchNo=t.fBatchNo,console.log(t.fQty),this.baseData.fcheckSum=Number(t.fQty),this.baseData.passSum=0,this.baseData.ngSum=0,this.baseData.fBillNo=e[0].fBillNo,this.baseData.fBillId=android.getUserID(),this.materialList.push(t),this.$api.get("/searchQCJCX",{mateNumber:t.materialNumber},function(e){o.e.clear(),e.status>=200&&e.status<300?"true"==e.data.success?(console.log(e.data.data),a.QCBaseData=JSON.parse(e.data.data),o.e.success("数据获取成功")):o.e.fail(e.data.msg):o.e.fail("数据获取异常！")}),this.$api.get("/selectAllEmpInfo",{},function(e){o.e.clear(),e.status>=200&&e.status<300?"true"==e.data.success?(a.shippers=e.data.data,a.Safekeepings=e.data.data,o.e.success("数据获取成功")):o.e.fail(e.data.msg):o.e.fail("数据获取异常！")})},computed:{newNgSum:function(){return this.baseData.ngSum}},watch:{newNgSum:{deep:!0,handler:function(a,e){console.log(1111),this.baseData.passSum=Math(this.baseData.fcheckSum-e)}}},methods:{showLoading:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},onSubmit:function(){if(this.showLoading("正在提交数据..."),this.newMaterialList.length==Number(this.baseData.fcheckSum)){var a=!1;if(this.newMaterialList.some(function(e,t){if(void 0==e.isOk)return a=!0,void o.e.fail(e.NbarcodeNumber+"数据缺失！")}),this.QCBaseData.some(function(e,t){if(void 0==e.isOk)return a=!0,void o.e.fail(e.qcName+"数据缺失！")}),!a){var e=[];this.fileList.some(function(a,t){var s={};s.content=a.content,s.fileName=a.file.name,s.size=a.file.size,e.push(s)}),this.$api.post("/submitQCLL",{baseData:S()(this.baseData),materialList:S()(this.newMaterialList),QCBaseData:S()(this.QCBaseData),content:S()(e)},function(a){if(o.e.clear(),!(a.status>=200&&a.status<300))return o.e.fail("数据提交异常！"),void console.log(a);"true"==a.data.success?(o.e.success("数据提交成功"),android.back()):o.e.fail(a.data.msg)})}}else o.e.fail("条码未扫描完毕！")},onBack:function(){this.$router.go(-1)},onSalesWayConfirm:function(a){this.baseData.salesWay=a.text,this.baseData.salesWayId=a.id,this.showSalesWayPicker=!1},onShipperConfirm:function(a){this.baseData.shipper=a.text,this.baseData.shipperId=a.id,this.showShipperPicker=!1},onSafekeepingConfirm:function(a){this.baseData.safeKeeping=a.text,this.baseData.safeKeepingId=a.id,this.showSafekeepingPicker=!1},deleteMaterial:function(){var a=this;this.newMaterialList.some(function(e,t){if(e.id==a.newActiveName)return a.newMaterialList.splice(t,1),"合格"==e.isOk?a.baseData.passSum=Number(a.baseData.passSum)-1:"不合格"==e.isOk&&(a.baseData.ngSum=Number(a.baseData.ngSum)-1),a.barcodeList.some(function(s,i){e.NbarcodeNumber==s.barcodeNumber&&a.barcodeList.splice(t,1)}),!0})},onSearch:function(){var a=this;if(0!=this.barcodeNumber.length){var e=!0;this.barcodeList.some(function(t,s){if(t.barcodeNumber==a.barcodeNumber)return o.e.fail("条码已扫描"),void(e=!1)}),e&&this.$api.get("/searchBarcodeNumber",{BarcodeNumber:this.barcodeNumber,id:"2"},function(e){return a.barcodeNumber="",a.focusNextInput(),e.status>=200&&e.status<300?"true"!=e.data.success?(o.e.clear(),void o.e.fail(e.data.msg)):(o.e.success("条码查询成功"),void JSON.parse(e.data.msg).some(function(e,t){if(console.log(e),e.typeNumber==a.baseData.fBillNo){var s=JSON.parse(S()(e));s.id=a.newMaterialList.length+1,s.NbarcodeNumber=e.barcodeNumber,s.fBatchNo=e.batch,s.materialNumber=e.mNumber,s.materialName=e.mName,a.newMaterialList.push(s),a.newActiveName=s.id,a.barcodeList.push(e)}})):(o.e.clear(),void o.e.fail("条码查询异常！"))})}},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.onSearch()},onSearchPlace:function(){var a=this;0!=this.baseData.stockPlace.length&&(this.showLoading("正在获取仓位..."),this.$api.get("/searchStockPlaceInfo",{stockplaceNumber:this.baseData.stockPlace},function(e){if(a.baseData.stockPlace="",o.e.clear(),e.status>=200&&e.status<300)if("true"==e.data.success){o.e.success("仓位获取成功");var t=JSON.parse(e.data.data);a.baseData.stockPlace=t.text,a.baseData.stockPlaceID=t.id}else o.e.fail(e.data.msg);else o.e.fail("数据获取异常")}))},focusNextInput:function(){document.getElementsByTagName("input")[0].focus()},onConfirm:function(a){var e=this;this.showIsOkPicker=!1,this.QCBaseData.some(function(t,s){e.activeName!=t.qcEntry||e.$set(t,"isOk",a)})},onMConfirm:function(a){var e=this;this.showMIsOkPicker=!1,this.newMaterialList.some(function(t,s){if(e.newActiveName==t.id)return"合格"==a?(t.isOk,"不合格"==t.isOk&&(e.baseData.passSum=Number(e.baseData.passSum)+1,e.baseData.ngSum=Number(e.baseData.ngSum)-1),void 0==t.isOk&&(e.baseData.passSum=Number(e.baseData.passSum)+1)):"不合格"==a&&("合格"==t.isOk&&(e.baseData.passSum=Number(e.baseData.passSum)-1,e.baseData.ngSum=Number(e.baseData.ngSum)+1),t.isOk,void 0==t.isOk&&(e.baseData.ngSum=Number(e.baseData.ngSum)+1)),void e.$set(t,"isOk",a)})}}},ua={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{attrs:{placeholder:"","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearch(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("基本信息")]),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"业务类型：",disabled:"","label-align":"left",readonly:""},model:{value:a.baseData.fposname,callback:function(e){a.$set(a.baseData,"fposname",e)},expression:"baseData.fposname"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"供应商：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fsupplyname,callback:function(e){a.$set(a.baseData,"fsupplyname",e)},expression:"baseData.fsupplyname"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料代码：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fmateNum,callback:function(e){a.$set(a.baseData,"fmateNum",e)},expression:"baseData.fmateNum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料名称：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fmateName,callback:function(e){a.$set(a.baseData,"fmateName",e)},expression:"baseData.fmateName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fBatchNo,callback:function(e){a.$set(a.baseData,"fBatchNo",e)},expression:"baseData.fBatchNo"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"检验数量：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fcheckSum,callback:function(e){a.$set(a.baseData,"fcheckSum",e)},expression:"baseData.fcheckSum"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"送检员：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showShipperPicker=!0}},model:{value:a.baseData.shipper,callback:function(e){a.$set(a.baseData,"shipper",e)},expression:"baseData.shipper"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showShipperPicker,callback:function(e){a.showShipperPicker=e},expression:"showShipperPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.shippers},on:{cancel:function(e){a.showShipperPicker=!1},confirm:a.onShipperConfirm}})],1)],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"检验员：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showSafekeepingPicker=!0}},model:{value:a.baseData.safeKeeping,callback:function(e){a.$set(a.baseData,"safeKeeping",e)},expression:"baseData.safeKeeping"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showSafekeepingPicker,callback:function(e){a.showSafekeepingPicker=e},expression:"showSafekeepingPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.Safekeepings},on:{cancel:function(e){a.showSafekeepingPicker=!1},confirm:a.onSafekeepingConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"合格数量：","label-align":"left"},model:{value:a.baseData.passSum,callback:function(e){a.$set(a.baseData,"passSum",e)},expression:"baseData.passSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"不合格数量：","label-align":"left",disabled:""},model:{value:a.baseData.ngSum,callback:function(e){a.$set(a.baseData,"ngSum",e)},expression:"baseData.ngSum"}})],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("附件明细")]),a._v(" "),t("van-row",{staticStyle:{margin:"0.3rem"}},[t("van-col",{attrs:{span:"24"}},[t("van-uploader",{attrs:{multiple:""},model:{value:a.fileList,callback:function(e){a.fileList=e},expression:"fileList"}})],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("检验项明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.QCBaseData,function(e){return t("van-collapse-item",{key:e.qcEntry,attrs:{title:e.qcName,name:e.qcEntry}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"检测项编码：",disabled:"","label-align":"left"},model:{value:e.qcNumber,callback:function(t){a.$set(e,"qcNumber",t)},expression:"item.qcNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"检测项名称：",disabled:"","label-align":"left"},model:{value:e.qcName,callback:function(t){a.$set(e,"qcName",t)},expression:"item.qcName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"是否合格：",disabled:"",required:"","label-align":"left"},on:{click:function(e){a.showIsOkPicker=!0}},model:{value:e.isOk,callback:function(t){a.$set(e,"isOk",t)},expression:"item.isOk"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showIsOkPicker,callback:function(e){a.showIsOkPicker=e},expression:"showIsOkPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.columns},on:{cancel:function(e){a.showIsOkPicker=!1},confirm:a.onConfirm}})],1)],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("扫描物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.newActiveName,callback:function(e){a.newActiveName=e},expression:"newActiveName"}},a._l(a.newMaterialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.fBatchNo,callback:function(t){a.$set(e,"fBatchNo",t)},expression:"item.fBatchNo"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"条码编号：","label-align":"left",disabled:""},model:{value:e.NbarcodeNumber,callback:function(t){a.$set(e,"NbarcodeNumber",t)},expression:"item.NbarcodeNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"是否合格：","label-align":"left",disabled:"",required:""},on:{click:function(e){a.showMIsOkPicker=!0}},model:{value:e.isOk,callback:function(t){a.$set(e,"isOk",t)},expression:"item.isOk"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showMIsOkPicker,callback:function(e){a.showMIsOkPicker=e},expression:"showMIsOkPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.columns},on:{cancel:function(e){a.showMIsOkPicker=!1},confirm:a.onMConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("提交")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},da=t("VU/8")(ca,ua,!1,null,null,null).exports,ma={data:function(){return{barcodeNumber:"",loading:!1,activeDocName:"",activeMateName:"",docList:[]}},methods:{toastLog:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},dealBarcodeNumber:function(){var a=this;0!=this.barcodeNumber.length?(this.toastLog("正在获取数据..."),this.$api.get("/selectReceiptNotice",{billNo:this.barcodeNumber},function(e){if(!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("数据获取异常！");if(o.e.clear(),"true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);var t=JSON.parse(e.data.msg);console.log(t);var s=!0;if(a.activeDocName=1,a.docList.some(function(a,e){a.purchasingUnit!=t.purchasingUnit&&(o.e.fail("购货单位必须一致！"),s=!1)}),s){a.$set(t,"id",a.docList.length+1);var i=0;a.docList.some(function(a,e){i=a.materialList.length+e}),t.materialList.some(function(e,t){i+=1,a.$set(e,"id",i)}),a.docList.push(t),o.e.success("成功"),console.log(a.docList)}})):o.e.fail("发货单号不得为空！")},onBack:function(){android.back()},onSubmit:function(){0!=this.docList.length?this.$router.push({path:"/PurchaseReceipt",query:{data:this.docList}}):o.e.fail("收料通知单数据不得为空！")},deleteMaterial:function(){var a=this;this.docList.some(function(e,t){e.id==a.activeDocName&&e.materialList.some(function(t,s){if(t.id==a.activeMateName)return 1==e.materialList.length?a.deleteConsignment():e.materialList.splice(s,1),!0})})},deleteConsignment:function(){var a=this;this.docList.some(function(e,t){if(e.id==a.activeDocName)return a.docList.splice(t,1),!0})},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.dealBarcodeNumber()}}},ba={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{placeholder:"请输入收料通知单","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.dealBarcodeNumber,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.dealBarcodeNumber(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.dealBarcodeNumber},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("收料通知单数据")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeDocName,callback:function(e){a.activeDocName=e},expression:"activeDocName"}},a._l(a.docList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.fBillNo,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单据编码：",disabled:"","label-align":"left"},model:{value:e.fBillNo,callback:function(t){a.$set(e,"fBillNo",t)},expression:"doc.fBillNo"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"购货单位：",disabled:"","label-align":"left"},model:{value:e.fsupplyname,callback:function(t){a.$set(e,"fsupplyname",t)},expression:"doc.fsupplyname"}})],1)],1),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeMateName,callback:function(e){a.activeMateName=e},expression:"activeMateName"}},a._l(e.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialNumber,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料名称：",disabled:"","label-align":"left"},model:{value:e.materialName,callback:function(t){a.$set(e,"materialName",t)},expression:"item.materialName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"数量：",disabled:"","label-align":"left"},model:{value:e.fQty,callback:function(t){a.$set(e,"fQty",t)},expression:"item.fQty"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：",disabled:"","label-align":"left"},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.fstockName,callback:function(t){a.$set(e,"fstockName",t)},expression:"item.fstockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.stockPlace,callback:function(t){a.$set(e,"stockPlace",t)},expression:"item.stockPlace"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.fBatchNo,callback:function(t){a.$set(e,"fBatchNo",t)},expression:"item.fBatchNo"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"自编码：",disabled:"","label-align":"left"},model:{value:e.zbm,callback:function(t){a.$set(e,"zbm",t)},expression:"item.zbm"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[""==a.activeMateName||0==e.materialList.length?t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteConsignment}},[a._v("删除")]):a._e()],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("确定")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},va=t("VU/8")(ma,ba,!1,null,null,null).exports,fa={data:function(){return{barcodeNumber:"",loading:!1,activeDocName:"",activeMateName:"",docList:[]}},methods:{toastLog:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},dealBarcodeNumber:function(){var a=this;0!=this.barcodeNumber.length?(this.toastLog("正在获取数据..."),this.$api.get("/selectReceiptNotice",{billNo:this.barcodeNumber,type:"QC"},function(e){if(!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("数据获取异常！");if(o.e.clear(),"true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);var t=JSON.parse(e.data.msg);console.log(t);var s=!0;if(a.activeDocName=1,a.docList.some(function(a,e){a.purchasingUnit!=t.purchasingUnit&&(o.e.fail("购货单位必须一致！"),s=!1)}),s){a.$set(t,"id",a.docList.length+1);var i=0;a.docList.some(function(a,e){i=a.materialList.length+e}),t.materialList.some(function(e,t){i+=1,a.$set(e,"id",i)}),a.docList.push(t),o.e.success("成功"),console.log(a.docList)}})):o.e.fail("发货单号不得为空！")},onSubmit:function(){var a=this;this.docList.some(function(e,t){e.id==a.activeDocName&&e.materialList.some(function(e,t){e.id==a.activeMateName&&a.$router.push({path:"/qcPurchaseReceipt",query:{data:a.docList,mate:e}})})})},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.dealBarcodeNumber()}}},pa={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{placeholder:"请输入收料通知单","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.dealBarcodeNumber,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.dealBarcodeNumber(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.dealBarcodeNumber},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("收料通知单数据")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeDocName,callback:function(e){a.activeDocName=e},expression:"activeDocName"}},a._l(a.docList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.fBillNo,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单据编码：",disabled:"","label-align":"left"},model:{value:e.fBillNo,callback:function(t){a.$set(e,"fBillNo",t)},expression:"doc.fBillNo"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"购货单位：",disabled:"","label-align":"left"},model:{value:e.fsupplyname,callback:function(t){a.$set(e,"fsupplyname",t)},expression:"doc.fsupplyname"}})],1)],1),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeMateName,callback:function(e){a.activeMateName=e},expression:"activeMateName"}},a._l(e.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialNumber,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料名称：",disabled:"","label-align":"left"},model:{value:e.materialName,callback:function(t){a.$set(e,"materialName",t)},expression:"item.materialName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"数量：",disabled:"","label-align":"left"},model:{value:e.fQty,callback:function(t){a.$set(e,"fQty",t)},expression:"item.fQty"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：",disabled:"","label-align":"left"},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.fstockName,callback:function(t){a.$set(e,"fstockName",t)},expression:"item.fstockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓位：",disabled:"","label-align":"left"},model:{value:e.stockPlace,callback:function(t){a.$set(e,"stockPlace",t)},expression:"item.stockPlace"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.fBatchNo,callback:function(t){a.$set(e,"fBatchNo",t)},expression:"item.fBatchNo"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"自编码：",disabled:"","label-align":"left"},model:{value:e.zbm,callback:function(t){a.$set(e,"zbm",t)},expression:"item.zbm"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.onSubmit}},[a._v("确定")])],1)],1)],1)}),1)],1)}),1)],1)])},staticRenderFns:[]},ha=t("VU/8")(fa,pa,!1,null,null,null).exports,ka={data:function(){return{barcodeNumber:"",baseData:{},activeName:"",newActiveName:"",showSalesWayPicker:!1,salesWays:[],showShipperPicker:!1,shippers:[],showSafekeepingPicker:!1,Safekeepings:[],materialList:[],newMaterialList:[],stackPlace:"",barcodeList:[]}},created:function(){var a=this;this.showLoading("正在加载...");var e=this.$route.query.data;this.baseData.fDeptID=e[0].fDeptID,this.baseData.fdeptName=e[0].fdeptName,this.baseData.fEmpID=e[0].fEmpID,this.baseData.fempName=e[0].fempName,this.baseData.salesMan=e[0].salesMan,this.baseData.salesManId=e[0].salesManId,this.baseData.shipper=e[0].shipper,this.baseData.shipperId=e[0].shipperId,this.baseData.fWorkShop=e[0].fWorkShop,this.baseData.fWorkShopId=e[0].fWorkShopId,this.baseData.rwBillNo=e[0].rwBillNo,this.baseData.stockPlace="",this.baseData.stockPlaceID="",this.baseData.creatorId=android.getUserID(),e.some(function(e,t){e.materialList.some(function(e,t){a.materialList.push(e)})}),this.$api.get("/selectAllEmpInfo",{},function(e){o.e.clear(),e.status>=200&&e.status<300?"true"==e.data.success?(a.shippers=e.data.data,a.Safekeepings=e.data.data,o.e.success("数据获取成功")):o.e.fail(e.data.msg):o.e.fail("数据获取异常！")})},methods:{onSearchPlace:function(){var a=this;0!=this.baseData.stockPlace.length&&(this.showLoading("正在获取仓位..."),this.$api.get("/searchStockPlaceInfo",{stockplaceNumber:this.baseData.stockPlace},function(e){if(a.baseData.stockPlace="",o.e.clear(),e.status>=200&&e.status<300)if("true"==e.data.success){o.e.success("仓位获取成功");var t=JSON.parse(e.data.data);a.baseData.stockPlace=t.text,a.baseData.stockPlaceID=t.id}else o.e.fail(e.data.msg);else o.e.fail("数据获取异常")}))},showLoading:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},onSubmit:function(){this.showLoading("正在提交数据..."),this.$api.post("/submitProductionReceipt",{baseData:S()(this.baseData),materialList:S()(this.newMaterialList),barcodeList:S()(this.barcodeList)},function(a){if(o.e.clear(),!(a.status>=200&&a.status<300))return o.e.fail("数据提交异常！"),void console.log(a);"true"==a.data.success?(o.e.success("数据提交成功"),android.back()):o.e.fail(a.data.msg)})},onBack:function(){this.$router.go(-1)},onSalesWayConfirm:function(a){this.baseData.salesWay=a.text,this.baseData.salesWayId=a.id,this.showSalesWayPicker=!1},onShipperConfirm:function(a){this.baseData.shipper=a.text,this.baseData.shipperId=a.id,this.showShipperPicker=!1},onSafekeepingConfirm:function(a){this.baseData.safeKeeping=a.text,this.baseData.safeKeepingId=a.id,this.showSafekeepingPicker=!1},deleteMaterial:function(){var a=this;this.newMaterialList.some(function(e,t){if(e.id==a.newActiveName)return a.newMaterialList.splice(t,1),a.barcodeList.some(function(s,i){e.mNumber==s.materialNumber&&a.barcodeList.splice(t,1)}),!0})},onSearch:function(){var a=this;if(0!=this.barcodeNumber.length){var e=!0;this.barcodeList.some(function(t,s){if(t.barcodeNumber==a.barcodeNumber)return a.barcodeNumber="",o.e.fail("条码已扫描"),void(e=!1)}),e&&this.$api.get("/searchBarcodeNumber",{BarcodeNumber:this.barcodeNumber,id:2},function(e){if(a.barcodeNumber="",o.e.clear(),a.focusNextInput(),!(e.status>=200&&e.status<300))return o.e.clear(),o.e.fail("条码查询异常！"),void(a.barcodeNumber="");if("true"!=e.data.success)return o.e.clear(),o.e.fail(e.data.msg),void(a.barcodeNumber="");o.e.success("条码查询成功");var t=JSON.parse(e.data.msg);a.materialList.some(function(e,s){"*"==e.stockPlace&&(e.stockPlace=""),t.some(function(t,s){var i=!0;if(a.newMaterialList.some(function(e,s){console.log(e),console.log(t),e.materialNumber==t.mNumber&&e.fBatchNo==t.batch&&e.fstockName==t.warehouse&&e.stockPlace==t.position&&(e.materialActualSum=Number(e.materialActualSum)+Number(t.mSum),i=!1,a.newActiveName=e.id,a.barcodeList.push(t))}),i){var n=JSON.parse(S()(e));n.id=a.newMaterialList.length+1,n.materialActualSum=Number(t.mSum),n.stockPlace=a.baseData.stockPlace,n.stockPlaceId=""==a.baseData.stockPlaceID?"0":a.baseData.stockPlaceID,a.newMaterialList.push(n),a.newActiveName=n.id,t.position=a.baseData.stockPlace,t.positionId=""==a.baseData.stockPlaceID?"0":a.baseData.stockPlaceID,a.barcodeList.push(t)}})})})}},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.onSearch()},focusNextInput:function(){document.getElementsByTagName("input")[0].focus()},nextTick:function(){var a=this;this.$nextTick(function(){a.$refs.stockPlace.focus()})}}},ga={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{attrs:{placeholder:"","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearch(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("基本信息")]),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"交货单位：","label-align":"left",disabled:""},model:{value:a.baseData.fWorkShop,callback:function(e){a.$set(a.baseData,"fWorkShop",e)},expression:"baseData.fWorkShop"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"当前仓位：","label-align":"left"},on:{keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearchPlace(e)}},model:{value:a.baseData.stockPlace,callback:function(e){a.$set(a.baseData,"stockPlace",e)},expression:"baseData.stockPlace"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"保管：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showSafekeepingPicker=!0}},model:{value:a.baseData.safeKeeping,callback:function(e){a.$set(a.baseData,"safeKeeping",e)},expression:"baseData.safeKeeping"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showSafekeepingPicker,callback:function(e){a.showSafekeepingPicker=e},expression:"showSafekeepingPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.Safekeepings},on:{cancel:function(e){a.showSafekeepingPicker=!1},confirm:a.onSafekeepingConfirm}})],1)],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"验收：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showShipperPicker=!0}},model:{value:a.baseData.shipper,callback:function(e){a.$set(a.baseData,"shipper",e)},expression:"baseData.shipper"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showShipperPicker,callback:function(e){a.showShipperPicker=e},expression:"showShipperPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.shippers},on:{cancel:function(e){a.showShipperPicker=!1},confirm:a.onShipperConfirm}})],1)],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("汇报物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.FBatchNo,callback:function(t){a.$set(e,"FBatchNo",t)},expression:"item.FBatchNo"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.fstockName,callback:function(t){a.$set(e,"fstockName",t)},expression:"item.fstockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{ref:"stockPlace",refInFor:!0,attrs:{label:"仓位：","label-align":"left",disabled:""},model:{value:e.fstockPlaceName,callback:function(t){a.$set(e,"fstockPlaceName",t)},expression:"item.fstockPlaceName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"应收数量：","label-align":"left",type:"number"},model:{value:e.fAuxQtyFinish,callback:function(t){a.$set(e,"fAuxQtyFinish",t)},expression:"item.fAuxQtyFinish"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("扫描物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.newActiveName,callback:function(e){a.newActiveName=e},expression:"newActiveName"}},a._l(a.newMaterialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.FBatchNo,callback:function(t){a.$set(e,"FBatchNo",t)},expression:"item.FBatchNo"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"仓库：",disabled:"","label-align":"left"},model:{value:e.fstockName,callback:function(t){a.$set(e,"fstockName",t)},expression:"item.fstockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{ref:"stockPlace",refInFor:!0,attrs:{label:"仓位：","label-align":"left",disabled:""},model:{value:e.fstockPlaceName,callback:function(t){a.$set(e,"fstockPlaceName",t)},expression:"item.fstockPlaceName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"应收数量：","label-align":"left",type:"number"},model:{value:e.fAuxQtyFinish,callback:function(t){a.$set(e,"fAuxQtyFinish",t)},expression:"item.fAuxQtyFinish"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"实收数量：","label-align":"left",type:"number",disabled:""},model:{value:e.materialActualSum,callback:function(t){a.$set(e,"materialActualSum",t)},expression:"item.materialActualSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("提交")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},Na=t("VU/8")(ka,ga,!1,null,null,null).exports,_a={data:function(){return{barcodeNumber:"",loading:!1,activeDocName:"",activeMateName:"",docList:[]}},methods:{toastLog:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},dealBarcodeNumber:function(){var a=this;0!=this.barcodeNumber.length?(this.toastLog("正在获取数据..."),this.$api.get("/selectProductionReport",{billNo:this.barcodeNumber},function(e){if(!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("数据获取异常！");if(o.e.clear(),"true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);var t=JSON.parse(e.data.msg),s=!0;if(a.activeDocName=1,a.docList.some(function(a,e){a.purchasingUnit!=t.purchasingUnit&&(o.e.fail("购货单位必须一致！"),s=!1)}),s){a.$set(t,"id",a.docList.length+1);var i=0;a.docList.some(function(a,e){i=a.materialList.length+e}),t.materialList.some(function(e,t){i+=1,a.$set(e,"id",i)}),a.docList.push(t),o.e.success("成功"),console.log(a.docList)}})):o.e.fail("生产汇报单号不得为空！")},onBack:function(){android.back()},onSubmit:function(){0!=this.docList.length?this.$router.push({path:"/ProductionReceipt",query:{data:this.docList}}):o.e.fail("生产汇报单数据不得为空！")},deleteMaterial:function(){var a=this;this.docList.some(function(e,t){e.id==a.activeDocName&&e.materialList.some(function(t,s){if(t.id==a.activeMateName)return 1==e.materialList.length?a.deleteConsignment():e.materialList.splice(s,1),!0})})},deleteConsignment:function(){var a=this;this.docList.some(function(e,t){if(e.id==a.activeDocName)return a.docList.splice(t,1),!0})},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.dealBarcodeNumber()}}},wa={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{placeholder:"请输入生产汇报单号","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.dealBarcodeNumber,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.dealBarcodeNumber(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.dealBarcodeNumber},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("生产汇报单数据")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeDocName,callback:function(e){a.activeDocName=e},expression:"activeDocName"}},a._l(a.docList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.fBillNo,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单据编码：",disabled:"","label-align":"left"},model:{value:e.fBillNo,callback:function(t){a.$set(e,"fBillNo",t)},expression:"doc.fBillNo"}})],1)],1),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeMateName,callback:function(e){a.activeMateName=e},expression:"activeMateName"}},a._l(e.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialNumber,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料名称：",disabled:"","label-align":"left"},model:{value:e.materialName,callback:function(t){a.$set(e,"materialName",t)},expression:"item.materialName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"数量：",disabled:"","label-align":"left"},model:{value:e.fAuxQtyFinish,callback:function(t){a.$set(e,"fAuxQtyFinish",t)},expression:"item.fAuxQtyFinish"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：",disabled:"","label-align":"left"},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.materialBatch,callback:function(t){a.$set(e,"materialBatch",t)},expression:"item.materialBatch"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[""==a.activeMateName||0==e.materialList.length?t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteConsignment}},[a._v("删除")]):a._e()],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("确定")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},Sa=t("VU/8")(_a,wa,!1,null,null,null).exports,Da={data:function(){return{barcodeNumber:"",baseData:{},activeName:"",showSalesWayPicker:!1,salesWays:[],showShipperPicker:!1,shippers:[],showSafekeepingPicker:!1,Safekeepings:[],materialList:[],newMaterialList:[]}},created:function(){var a=this;this.$api.get("/selectAllEmpInfo",{},function(e){o.e.clear(),e.status>=200&&e.status<300?"true"==e.data.success?(a.shippers=e.data.data,a.Safekeepings=e.data.data,o.e.success("数据获取成功")):o.e.fail(e.data.msg):o.e.fail("数据获取异常！")})},methods:{showLoading:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},onSubmit:function(){this.showLoading("正在提交数据..."),this.$api.post("/submitPurchaseReceipt",{baseData:S()(this.baseData),materialList:S()(this.newMaterialList)},function(a){if(o.e.clear(),!(a.status>=200&&a.status<300))return o.e.fail("数据提交异常！"),void console.log(a);"true"==a.data.success?(o.e.success("数据提交成功"),android.back()):o.e.fail(a.data.msg)})},onBack:function(){this.$router.go(-1)},onSalesWayConfirm:function(a){this.baseData.salesWay=a.text,this.baseData.salesWayId=a.id,this.showSalesWayPicker=!1},onShipperConfirm:function(a){this.baseData.shipper=a.text,this.baseData.shipperId=a.id,this.showShipperPicker=!1},onSafekeepingConfirm:function(a){this.baseData.safeKeeping=a.text,this.baseData.safeKeepingId=a.id,this.showSafekeepingPicker=!1},deleteMaterial:function(){var a=this;this.newMaterialList.some(function(e,t){if(e.id==a.activeName)return a.newMaterialList.splice(t,1),!0})},onSearch:function(){var a=this;if(0!=this.barcodeNumber.length){var e=!0;this.newMaterialList.some(function(t,s){if(t.NbarcodeNumber==a.barcodeNumber)return o.e.fail("条码已扫描"),void(e=!1)}),e&&this.$api.get("/searchBarcodeNumber",{BarcodeNumber:this.barcodeNumber},function(e){if(o.e.clear(),a.focusNextInput(),!(e.status>=200&&e.status<300))return o.e.clear(),o.e.fail("条码查询异常！"),void(a.barcodeNumber="");if("true"!=e.data.success)return o.e.clear(),o.e.fail(e.data.msg),void(a.barcodeNumber="");o.e.success("条码查询成功");var t=JSON.parse(e.data.msg);console.log(t),t.some(function(e,t){console.log(1);var s=e;console.log(s),s.id=a.newMaterialList.length+1,s.inStockPlace=a.baseData.inStockPlace,s.inStockName=a.baseData.inStockName,a.newMaterialList.push(s),console.log(a.newMaterialList),a.activeName=s.id,a.barcodeNumber=""})})}},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.onSearch()},focusNextInput:function(){document.getElementsByTagName("input")[0].focus()}}},xa={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{attrs:{placeholder:"","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearch(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("基本信息")]),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"部门：","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fdeptName,callback:function(e){a.$set(a.baseData,"fdeptName",e)},expression:"baseData.fdeptName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"保管：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showSafekeepingPicker=!0}},model:{value:a.baseData.safeKeeping,callback:function(e){a.$set(a.baseData,"safeKeeping",e)},expression:"baseData.safeKeeping"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showSafekeepingPicker,callback:function(e){a.showSafekeepingPicker=e},expression:"showSafekeepingPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.Safekeepings},on:{cancel:function(e){a.showSafekeepingPicker=!1},confirm:a.onSafekeepingConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"业务员：","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fempName,callback:function(e){a.$set(a.baseData,"fempName",e)},expression:"baseData.fempName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"验收：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showShipperPicker=!0}},model:{value:a.baseData.shipper,callback:function(e){a.$set(a.baseData,"shipper",e)},expression:"baseData.shipper"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showShipperPicker,callback:function(e){a.showShipperPicker=e},expression:"showShipperPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.shippers},on:{cancel:function(e){a.showShipperPicker=!1},confirm:a.onShipperConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"调入仓库：","label-align":"left"},model:{value:a.baseData.inStockName,callback:function(e){a.$set(a.baseData,"inStockName",e)},expression:"baseData.inStockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"调入仓位：","label-align":"left"},model:{value:a.baseData.inStockPlace,callback:function(e){a.$set(a.baseData,"inStockPlace",e)},expression:"baseData.inStockPlace"}})],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.newMaterialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.mNumber,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.mNumber,callback:function(t){a.$set(e,"mNumber",t)},expression:"item.mNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.batch,callback:function(t){a.$set(e,"batch",t)},expression:"item.batch"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"数量：","label-align":"left",type:"number"},model:{value:e.mSum,callback:function(t){a.$set(e,"mSum",t)},expression:"item.mSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：","label-align":"left",disabled:""},model:{value:e.unitName,callback:function(t){a.$set(e,"unitName",t)},expression:"item.unitName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"调入仓库：",disabled:"","label-align":"left"},model:{value:e.inStockName,callback:function(t){a.$set(e,"inStockName",t)},expression:"item.inStockName"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"调入仓位：","label-align":"left"},model:{value:e.inStockPlace,callback:function(t){a.$set(e,"inStockPlace",t)},expression:"item.inStockPlace"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"调出仓库：",disabled:"","label-align":"left"},model:{value:e.warehouse,callback:function(t){a.$set(e,"warehouse",t)},expression:"item.warehouse"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"调出仓位：","label-align":"left"},model:{value:e.position,callback:function(t){a.$set(e,"position",t)},expression:"item.position"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("提交")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},Pa=t("VU/8")(Da,xa,!1,null,null,null).exports,ya={data:function(){var a;return a={barcodeNumber:"",NbarcodeNumber:"",baseData:{},QCBaseData:{},activeName:"",newActiveName:"",showSalesWayPicker:!1,salesWays:[],showShipperPicker:!1,shippers:[],showSafekeepingPicker:!1,Safekeepings:[],materialList:[],newMaterialList:[],barcodeList:[],columns:["合格","不合格"],showIsOkPicker:!1,showMIsOkPicker:!1},la()(a,"showShipperPicker",!1),la()(a,"shippers",[]),la()(a,"showSafekeepingPicker",!1),la()(a,"Safekeepings",[]),la()(a,"fileList",[]),a},created:function(){var a=this;this.showLoading("正在加载...");var e=this.$route.query.data,t=this.$route.query.mate;this.baseData.fSupplyID=e[0].fWorkShopId,this.baseData.fsupplyname=e[0].fWorkShop,this.baseData.fmateNum=t.materialNumber,this.baseData.fmateName=t.materialName,this.baseData.fBatchNo=t.fBatchNo,this.baseData.fcheckSum=t.fAuxQtyFinish,this.baseData.passSum=0,this.baseData.ngSum=0,this.baseData.fBillNo=e[0].fBillNo,this.baseData.fBillId=android.getUserID(),this.materialList.push(t),this.$api.get("/searchQCJCX",{mateNumber:t.materialNumber},function(e){o.e.clear(),e.status>=200&&e.status<300?"true"==e.data.success?(console.log(e.data.data),a.QCBaseData=JSON.parse(e.data.data),o.e.success("数据获取成功")):o.e.fail(e.data.msg):o.e.fail("数据获取异常！")}),this.$api.get("/selectAllEmpInfo",{},function(e){o.e.clear(),e.status>=200&&e.status<300?"true"==e.data.success?(a.shippers=e.data.data,a.Safekeepings=e.data.data,o.e.success("数据获取成功")):o.e.fail(e.data.msg):o.e.fail("数据获取异常！")})},computed:{newNgSum:function(){return this.baseData.ngSum}},watch:{newNgSum:{deep:!0,handler:function(a,e){console.log(1111),this.baseData.passSum=Math(this.baseData.fcheckSum-e)}}},methods:{showLoading:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},onSubmit:function(){if(this.showLoading("正在提交数据..."),this.newMaterialList.length==Number(this.baseData.fcheckSum)){var a=!1;if(this.newMaterialList.some(function(e,t){if(void 0==e.isOk)return a=!0,void o.e.fail(e.NbarcodeNumber+"数据缺失！")}),this.QCBaseData.some(function(e,t){if(void 0==e.isOk)return a=!0,void o.e.fail(e.qcName+"数据缺失！")}),!a){var e=[];this.fileList.some(function(a,t){var s={};s.content=a.content,s.fileName=a.file.name,s.size=a.file.size,e.push(s)}),this.$api.post("/submitQCCP",{baseData:S()(this.baseData),materialList:S()(this.newMaterialList),QCBaseData:S()(this.QCBaseData),content:S()(e)},function(a){if(o.e.clear(),!(a.status>=200&&a.status<300))return o.e.fail("数据提交异常！"),void console.log(a);"true"==a.data.success?(o.e.success("数据提交成功"),android.back()):o.e.fail(a.data.msg)})}}else o.e.fail("条码未扫描完毕！")},onBack:function(){this.$router.go(-1)},onSalesWayConfirm:function(a){this.baseData.salesWay=a.text,this.baseData.salesWayId=a.id,this.showSalesWayPicker=!1},onShipperConfirm:function(a){this.baseData.shipper=a.text,this.baseData.shipperId=a.id,this.showShipperPicker=!1},onSafekeepingConfirm:function(a){this.baseData.safeKeeping=a.text,this.baseData.safeKeepingId=a.id,this.showSafekeepingPicker=!1},deleteMaterial:function(){var a=this;this.newMaterialList.some(function(e,t){if(e.id==a.newActiveName)return a.newMaterialList.splice(t,1),"合格"==e.isOk?a.baseData.passSum=Number(a.baseData.passSum)-1:"不合格"==e.isOk&&(a.baseData.ngSum=Number(a.baseData.ngSum)-1),a.barcodeList.some(function(s,i){e.NbarcodeNumber==s.barcodeNumber&&a.barcodeList.splice(t,1)}),!0})},onSearch:function(){var a=this;if(0!=this.barcodeNumber.length){var e=!0;this.barcodeList.some(function(t,s){if(t.barcodeNumber==a.barcodeNumber)return o.e.fail("条码已扫描"),void(e=!1)}),e&&this.$api.get("/searchBarcodeNumber",{BarcodeNumber:this.barcodeNumber,id:"2"},function(e){return a.barcodeNumber="",a.focusNextInput(),e.status>=200&&e.status<300?"true"!=e.data.success?(o.e.clear(),void o.e.fail(e.data.msg)):(o.e.success("条码查询成功"),void JSON.parse(e.data.msg).some(function(e,t){if(console.log(e),e.typeNumber==a.baseData.fBillNo){var s=JSON.parse(S()(e));s.id=a.newMaterialList.length+1,s.NbarcodeNumber=e.barcodeNumber,s.fBatchNo=e.batch,s.materialNumber=e.mNumber,s.materialName=e.mName,a.newMaterialList.push(s),a.newActiveName=s.id,a.barcodeList.push(e)}})):(o.e.clear(),void o.e.fail("条码查询异常！"))})}},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.onSearch()},onSearchPlace:function(){var a=this;0!=this.baseData.stockPlace.length&&(this.showLoading("正在获取仓位..."),this.$api.get("/searchStockPlaceInfo",{stockplaceNumber:this.baseData.stockPlace},function(e){if(a.baseData.stockPlace="",o.e.clear(),e.status>=200&&e.status<300)if("true"==e.data.success){o.e.success("仓位获取成功");var t=JSON.parse(e.data.data);a.baseData.stockPlace=t.text,a.baseData.stockPlaceID=t.id}else o.e.fail(e.data.msg);else o.e.fail("数据获取异常")}))},focusNextInput:function(){document.getElementsByTagName("input")[0].focus()},onConfirm:function(a){var e=this;this.showIsOkPicker=!1,this.QCBaseData.some(function(t,s){e.activeName!=t.qcEntry||e.$set(t,"isOk",a)})},onMConfirm:function(a){var e=this;this.showMIsOkPicker=!1,this.newMaterialList.some(function(t,s){if(e.newActiveName==t.id)return"合格"==a?(t.isOk,"不合格"==t.isOk&&(e.baseData.passSum=Number(e.baseData.passSum)+1,e.baseData.ngSum=Number(e.baseData.ngSum)-1),void 0==t.isOk&&(e.baseData.passSum=Number(e.baseData.passSum)+1)):"不合格"==a&&("合格"==t.isOk&&(e.baseData.passSum=Number(e.baseData.passSum)-1,e.baseData.ngSum=Number(e.baseData.ngSum)+1),t.isOk,void 0==t.isOk&&(e.baseData.ngSum=Number(e.baseData.ngSum)+1)),void e.$set(t,"isOk",a)})}}},Ca={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{attrs:{placeholder:"","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.onSearch,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.onSearch(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.onSearch},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("基本信息")]),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"供应商：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fsupplyname,callback:function(e){a.$set(a.baseData,"fsupplyname",e)},expression:"baseData.fsupplyname"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料代码：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fmateNum,callback:function(e){a.$set(a.baseData,"fmateNum",e)},expression:"baseData.fmateNum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料名称：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fmateName,callback:function(e){a.$set(a.baseData,"fmateName",e)},expression:"baseData.fmateName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fBatchNo,callback:function(e){a.$set(a.baseData,"fBatchNo",e)},expression:"baseData.fBatchNo"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"检验数量：",disabled:"","label-align":"left","label-width":"2rem"},model:{value:a.baseData.fcheckSum,callback:function(e){a.$set(a.baseData,"fcheckSum",e)},expression:"baseData.fcheckSum"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"送检员：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showShipperPicker=!0}},model:{value:a.baseData.shipper,callback:function(e){a.$set(a.baseData,"shipper",e)},expression:"baseData.shipper"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showShipperPicker,callback:function(e){a.showShipperPicker=e},expression:"showShipperPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.shippers},on:{cancel:function(e){a.showShipperPicker=!1},confirm:a.onShipperConfirm}})],1)],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{required:"",label:"检验员：",disabled:"","label-align":"left","label-width":"2rem"},on:{click:function(e){a.showSafekeepingPicker=!0}},model:{value:a.baseData.safeKeeping,callback:function(e){a.$set(a.baseData,"safeKeeping",e)},expression:"baseData.safeKeeping"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showSafekeepingPicker,callback:function(e){a.showSafekeepingPicker=e},expression:"showSafekeepingPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.Safekeepings},on:{cancel:function(e){a.showSafekeepingPicker=!1},confirm:a.onSafekeepingConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{disabled:"",label:"合格数量：","label-align":"left"},model:{value:a.baseData.passSum,callback:function(e){a.$set(a.baseData,"passSum",e)},expression:"baseData.passSum"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"不合格数量：","label-align":"left",disabled:""},model:{value:a.baseData.ngSum,callback:function(e){a.$set(a.baseData,"ngSum",e)},expression:"baseData.ngSum"}})],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("附件明细")]),a._v(" "),t("van-row",{staticStyle:{margin:"0.3rem"}},[t("van-col",{attrs:{span:"24"}},[t("van-uploader",{attrs:{multiple:""},model:{value:a.fileList,callback:function(e){a.fileList=e},expression:"fileList"}})],1)],1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("检验项明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeName,callback:function(e){a.activeName=e},expression:"activeName"}},a._l(a.QCBaseData,function(e){return t("van-collapse-item",{key:e.qcEntry,attrs:{title:e.qcName,name:e.qcEntry}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"检测项编码：",disabled:"","label-align":"left"},model:{value:e.qcNumber,callback:function(t){a.$set(e,"qcNumber",t)},expression:"item.qcNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"检测项名称：",disabled:"","label-align":"left"},model:{value:e.qcName,callback:function(t){a.$set(e,"qcName",t)},expression:"item.qcName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"是否合格：",disabled:"",required:"","label-align":"left"},on:{click:function(e){a.showIsOkPicker=!0}},model:{value:e.isOk,callback:function(t){a.$set(e,"isOk",t)},expression:"item.isOk"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showIsOkPicker,callback:function(e){a.showIsOkPicker=e},expression:"showIsOkPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.columns},on:{cancel:function(e){a.showIsOkPicker=!1},confirm:a.onConfirm}})],1)],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("扫描物料明细")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.newActiveName,callback:function(e){a.newActiveName=e},expression:"newActiveName"}},a._l(a.newMaterialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialName,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.fBatchNo,callback:function(t){a.$set(e,"fBatchNo",t)},expression:"item.fBatchNo"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"条码编号：","label-align":"left",disabled:""},model:{value:e.NbarcodeNumber,callback:function(t){a.$set(e,"NbarcodeNumber",t)},expression:"item.NbarcodeNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"是否合格：","label-align":"left",disabled:"",required:""},on:{click:function(e){a.showMIsOkPicker=!0}},model:{value:e.isOk,callback:function(t){a.$set(e,"isOk",t)},expression:"item.isOk"}}),a._v(" "),t("van-popup",{attrs:{position:"bottom"},model:{value:a.showMIsOkPicker,callback:function(e){a.showMIsOkPicker=e},expression:"showMIsOkPicker"}},[t("van-picker",{attrs:{"show-toolbar":"",columns:a.columns},on:{cancel:function(e){a.showMIsOkPicker=!1},confirm:a.onMConfirm}})],1)],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.deleteMaterial}},[a._v("删除")])],1)],1)],1)}),1)],1),a._v(" "),t("div",{staticClass:"form-item"},[t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small"},on:{click:a.onBack}},[a._v("返回")])],1),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{round:"",size:"small",type:"danger"},on:{click:a.onSubmit}},[a._v("提交")])],1),a._v(" "),t("van-col",{attrs:{span:"6"}})],1)],1)])},staticRenderFns:[]},$a=t("VU/8")(ya,Ca,!1,null,null,null).exports,La={data:function(){return{barcodeNumber:"",loading:!1,activeDocName:"",activeMateName:"",docList:[]}},methods:{toastLog:function(a){o.e.loading({duration:0,message:a,forbidClick:!0})},dealBarcodeNumber:function(){var a=this;this.docList=[],0!=this.barcodeNumber.length?(this.toastLog("正在获取数据..."),this.$api.get("/selectProductionReport",{billNo:this.barcodeNumber,type:"qc"},function(e){if(!(e.status>=200&&e.status<300))return o.e.clear(),void o.e.fail("数据获取异常！");if(o.e.clear(),"true"!=e.data.success)return o.e.clear(),void o.e.fail(e.data.msg);var t=JSON.parse(e.data.msg);console.log(t);var s=!0;if(a.activeDocName=1,a.docList.some(function(a,e){a.purchasingUnit!=t.purchasingUnit&&(o.e.fail("购货单位必须一致！"),s=!1)}),s){a.$set(t,"id",a.docList.length+1);var i=0;a.docList.some(function(a,e){i=a.materialList.length+e}),t.materialList.some(function(e,t){i+=1,a.$set(e,"id",i)}),a.docList.push(t),o.e.success("成功"),console.log(a.docList)}})):o.e.fail("生产汇报单号不得为空！")},onBack:function(){android.back()},onSubmit:function(){var a=this;this.docList.some(function(e,t){e.id==a.activeDocName&&e.materialList.some(function(e,t){if(e.id==a.activeMateName)return a.$router.push({path:"/qcProductionReceipt",query:{data:a.docList,mate:e}}),!0})})},openScanner:function(){android.openScanner()},scannerSearch:function(a){this.barcodeNumber=a,this.dealBarcodeNumber()}}},Ia={render:function(){var a=this,e=a.$createElement,t=a._self._c||e;return t("div",{staticClass:"body-bg"},[t("div",{staticClass:"form-item"},[t("van-search",{staticStyle:{"margin-right":"1rem","margin-left":"0.1rem"},attrs:{placeholder:"请输入生产汇报单号","show-action":"",shape:"round",clear:"","right-icon":""},on:{search:a.dealBarcodeNumber,keyup:function(e){return!e.type.indexOf("key")&&a._k(e.keyCode,"enter",13,e.key,"Enter")?null:a.dealBarcodeNumber(e)}},model:{value:a.barcodeNumber,callback:function(e){a.barcodeNumber=e},expression:"barcodeNumber"}},[t("div",{attrs:{slot:"action",disabled:"loading"},on:{click:a.dealBarcodeNumber},slot:"action"},[a._v("搜索")]),a._v(" "),t("div",{attrs:{slot:"right-icon"},on:{click:a.openScanner},slot:"right-icon"},[t("van-icon",{staticClass:"iconfont",attrs:{"class-prefix":"icon",name:"saomiao"}})],1)])],1),a._v(" "),t("div",{staticClass:"form-item"},[t("h2",{staticClass:"form-header"},[a._v("生产汇报单数据")]),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeDocName,callback:function(e){a.activeDocName=e},expression:"activeDocName"}},a._l(a.docList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.fBillNo,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单据编码：",disabled:"","label-align":"left"},model:{value:e.fBillNo,callback:function(t){a.$set(e,"fBillNo",t)},expression:"doc.fBillNo"}})],1)],1),a._v(" "),t("van-collapse",{attrs:{accordion:""},model:{value:a.activeMateName,callback:function(e){a.activeMateName=e},expression:"activeMateName"}},a._l(e.materialList,function(e){return t("van-collapse-item",{key:e.id,attrs:{title:e.materialNumber,name:e.id}},[t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料编码：",disabled:"","label-align":"left"},model:{value:e.materialNumber,callback:function(t){a.$set(e,"materialNumber",t)},expression:"item.materialNumber"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"物料名称：",disabled:"","label-align":"left"},model:{value:e.materialName,callback:function(t){a.$set(e,"materialName",t)},expression:"item.materialName"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"数量：",disabled:"","label-align":"left"},model:{value:e.fAuxQtyFinish,callback:function(t){a.$set(e,"fAuxQtyFinish",t)},expression:"item.fAuxQtyFinish"}})],1),a._v(" "),t("van-col",{attrs:{span:"12"}},[t("van-field",{attrs:{label:"单位：",disabled:"","label-align":"left"},model:{value:e.materialUnit,callback:function(t){a.$set(e,"materialUnit",t)},expression:"item.materialUnit"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"24"}},[t("van-field",{attrs:{label:"批号：",disabled:"","label-align":"left"},model:{value:e.materialBatch,callback:function(t){a.$set(e,"materialBatch",t)},expression:"item.materialBatch"}})],1)],1),a._v(" "),t("van-row",[t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6"}}),a._v(" "),t("van-col",{attrs:{span:"6",align:"center"}},[t("van-button",{staticClass:"button",attrs:{size:"mini",type:"danger"},on:{click:a.onSubmit}},[a._v("确定")])],1)],1)],1)}),1)],1)}),1)],1)])},staticRenderFns:[]},Ba=t("VU/8")(La,Ia,!1,null,null,null).exports;s.default.use(l.a);var Ma=new l.a({routes:[{path:"/jobBooking",name:"JobBooking",component:u},{path:"/helloWorld",name:"HelloWorld",component:m},{path:"/revisePassword",name:"RevisePassword",component:f},{path:"/inventoryQuery",name:"inventory",component:k},{path:"/producionFeeding",name:"producionFeeding",component:_},{path:"/producionFeedingForProductRequisit",name:"producionFeedingForProductRequisit",component:P},{path:"/consignmentNote",name:"ConsignmentNote",component:$},{path:"/consignmentNoteForSaleIssue",name:"ConsignmentNoteForSaleIssue",component:B},{path:"/boxing",name:"Boxing",component:O},{path:"/unPacking",name:"UnPacking",component:W},{path:"/miscellaneousIssue",name:"MiscellaneousIssue",component:J},{path:"/miscellaneousReceipt",name:"MiscellaneousReceipt",component:G},{path:"/auxCheckAll",name:"AuxCheckAll",component:Y},{path:"/auxCheck",name:"AuxCheck",component:ea},{path:"/purchaseReceipt",name:"PurchaseReceipt",component:ia},{path:"/qcpurchaseReceipt",name:"QCPurchaseReceipt",component:da},{path:"/receiptNotice",name:"ReceiptNotice",component:va},{path:"/qcreceiptNotice",name:"QCReceiptNotice",component:ha},{path:"/productionReceipt",name:"ProductionReceipt",component:Na},{path:"/productionReport",name:"ProductionReport",component:Sa},{path:"/qcproductionReceipt",name:"QCProductionReceipt",component:$a},{path:"/qcproductionReport",name:"QCProductionReport",component:Ba},{path:"/unBoxing",name:"UnBoxing",component:R},{path:"/directAllocation",name:"Requisition",component:Pa}]}),qa=(t("4ml/"),t("sEnP"),t("zL8q")),Oa=t.n(qa),Aa=(t("sVYa"),ra.a.create({baseURL:"",withCredentials:!0,headers:{"Content-Type":"application/x-www-form-urlencoded;charset=utf-8"},transformRequest:[function(a){var e="";for(var t in a)!0===a.hasOwnProperty(t)&&(e+=encodeURIComponent(t)+"="+encodeURIComponent(a[t])+"&");return e}]})),Ua=ra.a.create({baseURL:"http://localhost:8099/",withCredentials:!0,headers:{"Content-Type":"multipart/form-data"},transformRequest:[function(a){var e="";for(var t in a)!0===a.hasOwnProperty(t)&&(e+=encodeURIComponent(t)+"="+encodeURIComponent(a[t])+"&");return e}]});function Ra(a,e,t,s){Aa({method:a,url:e,data:"POST"===a||"PUT"===a?t:null,params:"GET"===a||"DELETE"===a?t:null}).then(function(a){s(a)}).catch(function(a){s(a)})}var Ea={get:function(a,e,t){return Ra("GET",a,e,t)},post:function(a,e,t){return Ra("POST",a,e,t)},put:function(a,e,t){return Ra("PUT",a,e,t)},delete:function(a,e,t){return Ra("DELETE",a,e,t)},postUp:function(a,e,t){return function(a,e,t,s){Ua({method:a,url:e,data:"POST"===a||"PUT"===a?t:null,params:"GET"===a||"DELETE"===a?t:null}).then(function(a){s(a)}).catch(function(a){s(a)})}("POST",a,e,t)}};t("bs3D"),t("TtOz");s.default.use(o.e),s.default.use(o.b),s.default.prototype.$api=Ea,s.default.use(Oa.a,{size:"small",zIndex:3e3}),s.default.use(o.f),s.default.config.productionTip=!1,new s.default({el:"#app",router:Ma,components:{App:n},template:"<App/>"})},TtOz:function(a,e){},UEbX:function(a,e){},ZsvG:function(a,e){},bs3D:function(a,e){},sEnP:function(a,e){}},["NHnr"]);
//# sourceMappingURL=app.d6702dbfe8cbf7f63fd5.js.map